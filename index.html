<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>כתב - משחק קלפי אותיות עברי</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700;900&display=swap');
        
        * {
            font-family: 'Rubik', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        .card {
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }
        
        .card:active {
            transform: scale(0.95);
        }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 1000;
            animation: confetti-fall 2s ease-out forwards;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 min-h-screen text-white">
    <div id="root"></div>
    
        <script>
        window.addEventListener('error', function(e) {
            var root = document.getElementById('root');
            if (root && !root.hasChildNodes()) {
                root.innerHTML = '<div style="color:#ff6b6b;padding:30px;font-family:monospace;direction:ltr;text-align:left;background:#1a1a2e;margin:20px;border-radius:15px;border:2px solid #ff6b6b;"><h2 style="color:#ffd93d;">⚠️ שגיאה בטעינה</h2><p>' + e.message + '</p><p style="color:#888;">Line: ' + (e.lineno || '?') + '</p></div>';
            }
        });
    </script>
    <script type="text/babel">
        const { useState } = React;
        

// ===============================
// מילון עברי מוטמע (2000+ מילים)
// ===============================

const HEBREW_DICTIONARY = new Set([
  'אב',
  'אבחנה',
  'אבטיח',
  'אבל',
  'אגורה',
  'אגם',
  'אגס',
  'אדום',
  'אהב',
  'אהבה',
  'אוהב',
  'אוהבים',
  'אוהבת',
  'אווז',
  'אוויר',
  'אוזן',
  'אוזניות',
  'אוזניים',
  'אוטובוס',
  'אויב',
  'אוכל',
  'אוכלים',
  'אוכלת',
  'אולי',
  'אומץ',
  'אופה',
  'אופנוע',
  'אופניים',
  'אוקיאנוס',
  'אור',
  'אות',
  'אזור',
  'אח',
  'אחד',
  'אחוז',
  'אחות',
  'אחרון',
  'אחרונה',
  'אחרי',
  'אחת',
  'איבד',
  'איבדה',
  'איבדו',
  'איבדנו',
  'איבדת',
  'איבדתי',
  'איטי',
  'איך',
  'אימון',
  'אינטרנט',
  'איפה',
  'אכל',
  'אכלה',
  'אכלו',
  'אכלנו',
  'אכלת',
  'אכלתי',
  'אכן',
  'אכסניה',
  'אל',
  'אלון',
  'אליפות',
  'אלף',
  'אם',
  'אמבולנס',
  'אמבטיה',
  'אמון',
  'אמיץ',
  'אמנות',
  'אמנם',
  'אמצע',
  'אמת',
  'אנגלית',
  'אנחנו',
  'אני',
  'אנרגיה',
  'אף',
  'אף אחד',
  'אפה',
  'אפונה',
  'אפור',
  'אפליקציה',
  'אפרסק',
  'אפשרי',
  'אצבע',
  'אצל',
  'ארבע',
  'ארבעה',
  'ארבעים',
  'ארוך',
  'ארון',
  'אריה',
  'ארנב',
  'ארנק',
  'ארץ',
  'אשכולית',
  'אשר',
  'את',
  'אתה',
  'אתם',
  'אתמול',
  'אתן',
  'אתר',
  'בא',
  'באה',
  'באו',
  'באים',
  'באנו',
  'באר',
  'באת',
  'באתי',
  'בבקשה',
  'בגד',
  'בגלל',
  'בדיקה',
  'בהצלחה',
  'בוקר',
  'בושה',
  'בז',
  'בחינה',
  'בחינם',
  'בטריה',
  'ביולוגיה',
  'ביטחון',
  'ביישן',
  'בין',
  'ביצה',
  'ביקש',
  'בירה',
  'ביש',
  'בישל',
  'בית',
  'בכה',
  'בלתי',
  'בן',
  'בנה',
  'בנו',
  'בני',
  'בנינו',
  'בנית',
  'בניתי',
  'בננה',
  'בנק',
  'בנתה',
  'בעוד',
  'בעיה',
  'בצורת',
  'בצל',
  'בקבוק',
  'ברד',
  'ברווז',
  'ברוש',
  'בריא',
  'בריאות',
  'בריכה',
  'ברך',
  'ברק',
  'בשר',
  'בת',
  'גאווה',
  'גבוה',
  'גבול',
  'גבינה',
  'גביע',
  'גבעה',
  'גג',
  'גדול',
  'גודל',
  'גולף',
  'גוף',
  'גופייה',
  'גורל',
  'גזע',
  'גזר',
  'גיאוגרפיה',
  'גינה',
  'גיר',
  'גל',
  'גליל',
  'גלים',
  'גם',
  'גמל',
  'גן',
  'גננת',
  'גרב',
  'גרביים',
  'גרוע',
  'גרמנית',
  'גרף',
  'גשם',
  'גשר',
  'דבק',
  'דבר',
  'דג',
  'דואר',
  'דוב',
  'דובדבן',
  'דוד',
  'דודה',
  'דוקטור',
  'דיבר',
  'דיברה',
  'דיברו',
  'דיברנו',
  'דיברת',
  'דיברתי',
  'דיור',
  'דירה',
  'דלת',
  'דף',
  'דקה',
  'דרך',
  'דרש',
  'דשא',
  'האם',
  'הגיע',
  'הד',
  'הוא',
  'הודעה',
  'הווה',
  'הולך',
  'הולכים',
  'הולכת',
  'הורים',
  'הזדמנות',
  'הזמין',
  'היא',
  'היום',
  'היכן',
  'היסטוריה',
  'הכרחי',
  'הלך',
  'הלכה',
  'הלכו',
  'הלכנו',
  'הלכת',
  'הלכתי',
  'הם',
  'המצאה',
  'המתין',
  'הן',
  'הנה',
  'הנחה',
  'הסביר',
  'הסכים',
  'הערה',
  'הפסד',
  'הציע',
  'הצלחה',
  'הצפה',
  'הר',
  'הרבה',
  'הרי',
  'הרס',
  'התנגד',
  'התעמלות',
  'וילון',
  'ורוד',
  'זאב',
  'זהב',
  'זוג',
  'זוהר',
  'זוכר',
  'זוכרים',
  'זוכרת',
  'זול',
  'זמזום',
  'זמן',
  'זעק',
  'זרע',
  'חבר',
  'חברה',
  'חברים',
  'חג',
  'חגורה',
  'חגיגה',
  'חד',
  'חדר',
  'חדש',
  'חוב',
  'חודש',
  'חוכמה',
  'חולה',
  'חולצה',
  'חום',
  'חומוס',
  'חוף',
  'חופש',
  'חופשה',
  'חוק',
  'חורש',
  'חושב',
  'חושבים',
  'חושבת',
  'חושך',
  'חזק',
  'חזר',
  'חיבור',
  'חייל',
  'חיל',
  'חילוק',
  'חינוך',
  'חינם',
  'חיסון',
  'חיסור',
  'חיפה',
  'חישוב',
  'חכם',
  'חלב',
  'חלה',
  'חלום',
  'חלון',
  'חליפה',
  'חלק',
  'חלקים',
  'חלש',
  'חם',
  'חמאה',
  'חמוד',
  'חמוץ',
  'חמור',
  'חמישה',
  'חמישי',
  'חמישים',
  'חמישית',
  'חמש',
  'חנוכה',
  'חנות',
  'חסה',
  'חסידה',
  'חפר',
  'חצאית',
  'חצוף',
  'חצי',
  'חציל',
  'חצר',
  'חריג',
  'חריף',
  'חשב',
  'חשבה',
  'חשבו',
  'חשבון',
  'חשבנו',
  'חשבת',
  'חשבתי',
  'חשוב',
  'חשמלאי',
  'חתול',
  'חתונה',
  'טבח',
  'טוב',
  'טוש',
  'טיגן',
  'טיול',
  'טייס',
  'טיפש',
  'טכנולוגיה',
  'טל',
  'טלוויזיה',
  'טלפון',
  'טניס',
  'טעות',
  'יבש',
  'יבשת',
  'יד',
  'ידיד',
  'ידידה',
  'ידידות',
  'ידיים',
  'ידע',
  'ידעה',
  'ידעו',
  'ידענו',
  'ידעת',
  'ידעתי',
  'יוגה',
  'יודע',
  'יודעים',
  'יודעת',
  'יום',
  'יונה',
  'יופי',
  'יושב',
  'יושבים',
  'יושבת',
  'יחיד',
  'יין',
  'יכול',
  'יכולה',
  'יכולים',
  'ילד',
  'ילדה',
  'ילדים',
  'ים',
  'ינשוף',
  'יעיל',
  'יער',
  'יפה',
  'יקר',
  'ירוק',
  'ירושלים',
  'ירח',
  'ירק',
  'ישן',
  'ישנה',
  'ישנים',
  'כאב',
  'כאן',
  'כבאי',
  'כבד',
  'כבוד',
  'כביש',
  'כבר',
  'כבשה',
  'כדורגל',
  'כדורסל',
  'כדי',
  'כובע',
  'כוכב',
  'כולם',
  'כולן',
  'כולנו',
  'כוס',
  'כוסברה',
  'כועס',
  'כותב',
  'כותבים',
  'כותבת',
  'כזאת',
  'כזה',
  'כחול',
  'כי',
  'כיבס',
  'כיכר',
  'כימיה',
  'כיסא',
  'כישלון',
  'כישרון',
  'כיתה',
  'כך',
  'כל אחד',
  'כלב',
  'כלכלה',
  'כלל',
  'כלפי',
  'כלשהו',
  'כמה',
  'כמות',
  'כן',
  'כסף',
  'כעס',
  'כף',
  'כפל',
  'כפפה',
  'כפר',
  'כרוב',
  'כרם',
  'כש',
  'כתב',
  'כתבה',
  'כתבו',
  'כתבנו',
  'כתבת',
  'כתבתי',
  'כתום',
  'כתף',
  'לא',
  'לב',
  'לבן',
  'להבה',
  'להתראות',
  'לוח',
  'לומד',
  'לומדים',
  'לומדת',
  'לחי',
  'לחם',
  'לחש',
  'ליד',
  'לילה',
  'לימון',
  'לכן',
  'למד',
  'למדה',
  'למדו',
  'למדנו',
  'למדת',
  'למדתי',
  'למה',
  'למען',
  'לפי',
  'לפיכך',
  'לפני',
  'לקח',
  'לקחה',
  'לקחו',
  'לקחנו',
  'לקחת',
  'לקחתי',
  'לשון',
  'מאד',
  'מאה',
  'מאוד',
  'מאוהב',
  'מבחן',
  'מבשל',
  'מבשלת',
  'מדבר',
  'מדברים',
  'מדברת',
  'מדוע',
  'מדינה',
  'מדע',
  'מדף',
  'מדפסת',
  'מדרכה',
  'מה',
  'מהיר',
  'מהנדס',
  'מהנה',
  'מוגדר',
  'מוגדרת',
  'מודרני',
  'מוזיאון',
  'מוזיקה',
  'מוח',
  'מוכן',
  'מוכנה',
  'מוכנים',
  'מונית',
  'מופתע',
  'מורה',
  'מושב',
  'מזון',
  'מזכירה',
  'מזל',
  'מזלג',
  'מחברת',
  'מחבת',
  'מחדד',
  'מחוז',
  'מחוספס',
  'מחיר',
  'מחלה',
  'מחנה',
  'מחפש',
  'מחפשת',
  'מחק',
  'מחר',
  'מחשב',
  'מטבח',
  'מטוס',
  'מטען',
  'מטרה',
  'מי',
  'מידה',
  'מידע',
  'מיומנות',
  'מיותר',
  'מיטה',
  'מילה',
  'מים',
  'מיעוט',
  'מיץ',
  'מיקרופון',
  'מישהו',
  'מישהי',
  'מכונית',
  'מכוער',
  'מכיוון',
  'מכירה',
  'מכנסיים',
  'מכר',
  'מכרה',
  'מכרו',
  'מכרנו',
  'מכרת',
  'מכרתי',
  'מלא',
  'מלוכלך',
  'מלון',
  'מלח',
  'מלחמה',
  'מלמד',
  'מלמדים',
  'מלמדת',
  'מלפפון',
  'מלצר',
  'מן',
  'מנגינה',
  'מנגן',
  'מנגנים',
  'מנגנת',
  'מנהל',
  'מנורה',
  'מס',
  'מסובך',
  'מסוק',
  'מסיבה',
  'מסך',
  'מסלול',
  'מספר',
  'מספריים',
  'מסקרן',
  'מעולה',
  'מעט',
  'מעיל',
  'מעין',
  'מעל',
  'מפה',
  'מפחיד',
  'מפל',
  'מצא',
  'מצאה',
  'מצאו',
  'מצאנו',
  'מצאת',
  'מצאתי',
  'מצוין',
  'מצח',
  'מצלמה',
  'מצפה',
  'מקלדת',
  'מר',
  'מרגיע',
  'מרכול',
  'מרכז',
  'מרפאה',
  'מרפסת',
  'מרפק',
  'מרתף',
  'מרתק',
  'משאית',
  'משוואה',
  'משום',
  'משחק',
  'משחקים',
  'משחקת',
  'משטרה',
  'משעמם',
  'משפחה',
  'משפט',
  'משקל',
  'מתוק',
  'מתי',
  'מתמטיקה',
  'נגב',
  'נגד',
  'נגר',
  'נהג',
  'נהר',
  'נוח',
  'נוסחה',
  'נופש',
  'נורא',
  'נושא',
  'נחל',
  'נחם',
  'נחמד',
  'נטע',
  'ניגן',
  'נייד',
  'ניסוי',
  'ניסיון',
  'ניצוץ',
  'ניצחון',
  'ניקה',
  'ניקוד',
  'ניתוח',
  'נכד',
  'נכדה',
  'נמוך',
  'נמל',
  'נמר',
  'נסיעה',
  'נעל',
  'נעליים',
  'נפח',
  'נפלא',
  'נקי',
  'נשאר',
  'נשר',
  'נתן',
  'נתנה',
  'נתנו',
  'נתת',
  'נתתי',
  'סבא',
  'סביב',
  'סבתא',
  'סגול',
  'סגר',
  'סגרה',
  'סגרו',
  'סגרנו',
  'סגרת',
  'סגרתי',
  'סווטר',
  'סוכות',
  'סוכר',
  'סוס',
  'סוף',
  'סופה',
  'סידר',
  'סיור',
  'סיפור',
  'סיר',
  'סירב',
  'סירה',
  'סכין',
  'סכנה',
  'סלון',
  'סליחה',
  'סמטה',
  'סנאי',
  'סנדל',
  'סנטר',
  'סערה',
  'ספה',
  'ספורט',
  'ספינה',
  'ספר',
  'ספרדית',
  'ספריה',
  'סרגל',
  'עבד',
  'עבדה',
  'עבדו',
  'עבדנו',
  'עבדת',
  'עבדתי',
  'עבר',
  'עברית',
  'עגבניה',
  'עגול',
  'עד',
  'עדשים',
  'עובד',
  'עובדים',
  'עובדת',
  'עוד',
  'עודד',
  'עוול',
  'עולם',
  'עומד',
  'עומדים',
  'עומדת',
  'עוף',
  'עור',
  'עורב',
  'עז',
  'עזב',
  'עט',
  'עייף',
  'עין',
  'עיניים',
  'עיפרון',
  'עיר',
  'עכבר',
  'עכשיו',
  'על',
  'עלה',
  'עלות',
  'עלים',
  'עם',
  'עמוד',
  'עמוק',
  'עמק',
  'ענב',
  'ענה',
  'עני',
  'עניין',
  'ענן',
  'עננים',
  'ענף',
  'עץ',
  'עצב',
  'עצוב',
  'עצים',
  'עצם',
  'עצמות',
  'עקב',
  'ערב',
  'ערבית',
  'ערפל',
  'עשב',
  'עשיר',
  'עשירי',
  'עשר',
  'עשרה',
  'עשרים',
  'עתיד',
  'עתיק',
  'פארק',
  'פה',
  'פוחד',
  'פורים',
  'פחד',
  'פטרוזיליה',
  'פיזיקה',
  'פייס',
  'פיל',
  'פיתה',
  'פלפל',
  'פנס',
  'פסח',
  'פסל',
  'פקיד',
  'פקידה',
  'פרדס',
  'פרה',
  'פרח',
  'פרחים',
  'פרי',
  'פשוט',
  'פתח',
  'פתחה',
  'פתחו',
  'פתחנו',
  'פתחת',
  'פתחתי',
  'פתרון',
  'צבא',
  'צדק',
  'צהוב',
  'צוות',
  'צומת',
  'צחק',
  'ציור',
  'צייר',
  'ציפור',
  'ציפורן',
  'צל',
  'צלחת',
  'צליל',
  'צמא',
  'צמח',
  'צעיף',
  'צר',
  'צריך',
  'צריכה',
  'צריכים',
  'צרפתית',
  'קבוצה',
  'קול',
  'קולנוע',
  'קוקייה',
  'קורא',
  'קוראים',
  'קוראת',
  'קורקינט',
  'קטן',
  'קיבה',
  'קיבוץ',
  'קיפל',
  'קיר',
  'קישוא',
  'קל',
  'קלמר',
  'קם',
  'קמה',
  'קמים',
  'קנאה',
  'קנה',
  'קנו',
  'קניה',
  'קניון',
  'קנינו',
  'קנית',
  'קניתי',
  'קנתה',
  'קערה',
  'קפה',
  'קפץ',
  'קצין',
  'קצר',
  'קצת',
  'קר',
  'קרא',
  'קראה',
  'קראו',
  'קראנו',
  'קראת',
  'קראתי',
  'קרסול',
  'קשה',
  'קשת',
  'ראה',
  'ראו',
  'ראינו',
  'ראית',
  'ראיתי',
  'ראש',
  'ראשון',
  'ראשונה',
  'ראתה',
  'רביעי',
  'רביעית',
  'רבע',
  'רגל',
  'רגליים',
  'רגע',
  'רדוד',
  'רדיו',
  'רואה',
  'רואים',
  'רוב',
  'רוגע',
  'רוח',
  'רוסית',
  'רופא',
  'רופאה',
  'רוצה',
  'רוצים',
  'רוקח',
  'רחב',
  'רחוב',
  'רטוב',
  'ריאה',
  'ריב',
  'רימון',
  'ריצה',
  'ריק',
  'ריקוד',
  'רך',
  'רכבת',
  'רמזור',
  'רמקול',
  'רע',
  'רעב',
  'רעם',
  'רעש',
  'רץ',
  'רצה',
  'רצים',
  'רצפה',
  'רק',
  'רשת',
  'שאל',
  'שאלה',
  'שבוע',
  'שבור',
  'שביעי',
  'שבע',
  'שבעה',
  'שבעים',
  'שבר',
  'שברה',
  'שברו',
  'שברנו',
  'שברת',
  'שברתי',
  'שבת',
  'שדרה',
  'שוטר',
  'שוכח',
  'שוכחים',
  'שוכחת',
  'שולחן',
  'שום',
  'שומע',
  'שומעים',
  'שומעת',
  'שונא',
  'שונאים',
  'שונאת',
  'שועל',
  'שופט',
  'שוק',
  'שורש',
  'שותה',
  'שותים',
  'שזיף',
  'שחור',
  'שחייה',
  'שטוח',
  'שטיח',
  'שטף',
  'שידה',
  'שיחה',
  'שיחק',
  'שיחקה',
  'שיחקו',
  'שיחקנו',
  'שיחקת',
  'שיחקתי',
  'שימושי',
  'שיניים',
  'שיעור',
  'שיער',
  'שיר',
  'שירה',
  'שירותים',
  'שישה',
  'שישי',
  'שישים',
  'שישית',
  'שכונה',
  'של',
  'שלג',
  'שלה',
  'שלהבת',
  'שלהם',
  'שלו',
  'שלום',
  'שלוש',
  'שלושה',
  'שלושים',
  'שלט',
  'שלי',
  'שליש',
  'שלישי',
  'שלישית',
  'שלך',
  'שלכם',
  'שלם',
  'שלנו',
  'שם',
  'שמונה',
  'שמונים',
  'שמח',
  'שמחה',
  'שמיים',
  'שמיני',
  'שמלה',
  'שמן',
  'שמע',
  'שמעה',
  'שמעו',
  'שמענו',
  'שמעת',
  'שמעתי',
  'שמש',
  'שן',
  'שנא',
  'שנאה',
  'שנה',
  'שנהב',
  'שני',
  'שנייה',
  'שניים',
  'שסק',
  'שעה',
  'שעועית',
  'שפה',
  'שקט',
  'שקל',
  'שקר',
  'שר',
  'שרברב',
  'שרה',
  'שרון',
  'שרים',
  'שריפה',
  'שריר',
  'שרק',
  'שש',
  'שתה',
  'שתו',
  'שתיים',
  'שתינו',
  'שתית',
  'שתיתי',
  'שתק',
  'שתתה',
  'תה',
  'תודה',
  'תוכי',
  'תוכנה',
  'תוכנית',
  'תות',
  'תחבורה',
  'תחילה',
  'תחנה',
  'תחת',
  'תיאטרון',
  'תיאר',
  'תיק',
  'תיקון',
  'תיקן',
  'תכלת',
  'תלה',
  'תלמיד',
  'תלמידה',
  'תמונה',
  'תמר',
  'תפוז',
  'תפוח',
  'תקווה',
  'תקרה',
  'תרגיל',
  'תרד',
  'תרומה',
  'תרופה',
  'תרנגול',
  'תרנגולת',
  'תשובה',
  'תשיעי',
  'תשלום',
  'תשע',
  'תשעה',
  'תשעים'
]);


// פונקציה לבדיקת מילה במילון + API
async function validateHebrewWord(word) {
  // 1. בדיקה מהירה - מילון מקומי
  if (HEBREW_DICTIONARY.has(word)) {
    return { valid: true, source: 'dictionary' };
  }
  
  // 2. בדיקה ב-Wiktionary API (גיבוי)
  try {
    const response = await fetch(
      `https://he.wiktionary.org/w/api.php?` +
      `action=query&titles=${encodeURIComponent(word)}` +
      `&format=json&origin=*`,
      { 
        signal: AbortSignal.timeout(3000) // timeout של 3 שניות
      }
    );
    
    const data = await response.json();
    const pages = data.query.pages;
    const pageId = Object.keys(pages)[0];
    
    if (pageId !== '-1') {
      return { valid: true, source: 'wiktionary' };
    }
  } catch (error) {
    // במקרה של שגיאת רשת - פשוט נמשיך
    console.log('Wiktionary lookup failed:', error.message);
  }
  
  // 3. במצב חופשי - תמיד תקבל
  // במצב ילדים - יצטרך אישור הורה
  return { valid: false, source: 'not_found' };
}

// ===============================
// קבועים ונתונים
// ===============================

const LETTER_VALUES = {
  'א': 1, 'ב': 2, 'ג': 3, 'ד': 4, 'ה': 5,
  'ו': 6, 'ז': 7, 'ח': 8, 'ט': 9, 'י': 10,
  'כ': 11, 'ך': 11, 'ל': 12, 'מ': 13, 'ם': 13,
  'נ': 14, 'ן': 14, 'ס': 15, 'ע': 16,
  'פ': 17, 'ף': 17, 'צ': 18, 'ץ': 18,
  'ק': 19, 'ר': 20, 'ש': 21, 'ת': 22,
  '*': 0
};

// צבעים לאותיות - מחולקים באופן שווה
const LETTER_COLORS = {
  // אדום 🔴
  'א': 'red', 'ה': 'red', 'ט': 'red', 'מ': 'red', 'ם': 'red', 'ע': 'red', 'ת': 'red',
  // כחול 🔵
  'ב': 'blue', 'ו': 'blue', 'י': 'blue', 'נ': 'blue', 'ן': 'blue', 'ס': 'blue', 'ש': 'blue',
  // צהוב 🟡
  'ג': 'yellow', 'ז': 'yellow', 'כ': 'yellow', 'ך': 'yellow', 'פ': 'yellow', 'ף': 'yellow', 'ק': 'yellow',
  // ירוק 🟢
  'ד': 'green', 'ח': 'green', 'ל': 'green', 'צ': 'green', 'ץ': 'green', 'ר': 'green',
  // Wildcard - קשת (כל הצבעים)
  '*': 'rainbow'
};

const COLOR_STYLES = {
  red: {
    gradient: 'from-red-400 via-red-300 to-red-200',
    border: 'border-red-600',
    text: 'text-red-900',
    shadow: 'shadow-red-500/40',
    name: 'אדום',
    icon: '🔴'
  },
  blue: {
    gradient: 'from-blue-400 via-blue-300 to-blue-200',
    border: 'border-blue-600',
    text: 'text-blue-900',
    shadow: 'shadow-blue-500/40',
    name: 'כחול',
    icon: '🔵'
  },
  yellow: {
    gradient: 'from-yellow-400 via-yellow-300 to-yellow-200',
    border: 'border-yellow-600',
    text: 'text-yellow-900',
    shadow: 'shadow-yellow-500/40',
    name: 'צהוב',
    icon: '🟡'
  },
  green: {
    gradient: 'from-green-400 via-green-300 to-green-200',
    border: 'border-green-600',
    text: 'text-green-900',
    shadow: 'shadow-green-500/40',
    name: 'ירוק',
    icon: '🟢'
  },
  rainbow: {
    gradient: 'from-purple-400 via-pink-300 to-purple-200',
    border: 'border-purple-600',
    text: 'text-purple-900',
    shadow: 'shadow-purple-500/40',
    name: 'קשת',
    icon: '🌈'
  }
};

const JOKERS = [
  // Common (3-4₪)
  { id: 'bgdkft', name: 'בגד כפת', desc: 'בגדכפת ×1.5', cost: 3, icon: '📌', rarity: 'common' },
  { id: 'heavy', name: 'כבדי משקל', desc: 'ק-ת ×2', cost: 4, icon: '💪', rarity: 'common' },
  { id: 'doubles', name: 'כפילות', desc: 'אות כפולה +20', cost: 4, icon: '👥', rarity: 'common' },
  { id: 'first10', name: 'חזקים ראשונים', desc: 'א-י +5', cost: 3, icon: '🔢', rarity: 'common' },
  { id: 'middle', name: 'אמצע הדרך', desc: 'כ-ע +8', cost: 3, icon: '⚖️', rarity: 'common' },
  { id: 'alphabet', name: 'כל האלפבית', desc: 'כל אות +2', cost: 4, icon: '🔤', rarity: 'common' },
  { id: 'wildcard_lover', name: 'אוהב כוכבים', desc: 'קלף כוכב (★) שווה 10 ×10 = 100 נקודות!', cost: 3, icon: '🌟', rarity: 'common' },
  { id: 'short_words', name: 'מילים קצרות', desc: '2-3 אותיות +25', cost: 3, icon: '📐', rarity: 'common' },
  { id: 'vowels', name: 'אותיות אמהות', desc: 'א/ו/י +3', cost: 3, icon: '🎵', rarity: 'common' },
  { id: 'neighbor', name: 'שכן טוב', desc: 'אותיות סמוכות זהות +15', cost: 3, icon: '🤝', rarity: 'common' },
  
  // Uncommon (5-7₪)
  { id: 'golden_finals', name: 'סופיות זהב', desc: 'ךםןףץ ×3', cost: 5, icon: '🏅', rarity: 'uncommon' },
  { id: 'big_head', name: 'ראש גדול', desc: 'אות ראשונה ×4', cost: 5, icon: '🎯', rarity: 'uncommon' },
  { id: 'happy_end', name: 'סוף טוב', desc: 'אות אחרונה ×4', cost: 5, icon: '🎆', rarity: 'uncommon' },
  { id: 'middle_king', name: 'מלך האמצע', desc: 'אות אמצעית ×5', cost: 6, icon: '👑', rarity: 'uncommon' },
  { id: 'rising', name: 'מסלול עולה', desc: 'אותיות עולות ×10', cost: 7, icon: '📈', rarity: 'uncommon' },
  { id: 'falling', name: 'מסלול יורד', desc: 'אותיות יורדות ×10', cost: 7, icon: '📉', rarity: 'uncommon' },
  { id: 'collector', name: 'אוסף אותיות', desc: 'אות ייחודית +10', cost: 6, icon: '🎨', rarity: 'uncommon' },
  { id: 'leap', name: 'קפיצת ענק', desc: 'הפרש 10+ בין אותיות → +50', cost: 6, icon: '🦘', rarity: 'uncommon' },
  { id: 'balance', name: 'מאזניים', desc: 'סכום זוגי +25', cost: 5, icon: '⚖️', rarity: 'uncommon' },
  { id: 'lucky_7', name: 'מזל 7', desc: 'סכום מתחלק ב-7 → ×3', cost: 6, icon: '🍀', rarity: 'uncommon' },
  { id: 'money_maker', name: 'מכונת כסף', desc: '+1₪ לכל מילה', cost: 5, icon: '💰', rarity: 'uncommon' },
  { id: 'hand_giver', name: 'נותן ידיים', desc: '+1 יד לכל Blind', cost: 7, icon: '✋', rarity: 'uncommon' },
  { id: 'discard_giver', name: 'נותן זריקות', desc: '+1 זריקה לכל Blind', cost: 6, icon: '🔄', rarity: 'uncommon' },
  { id: 'even_odd', name: 'זוגי ואי-זוגי', desc: 'אם יש גם אות זוגית וגם אי-זוגית, +30 צ׳יפס', cost: 6, icon: '🎲', rarity: 'uncommon' },
  { id: 'mirror', name: 'מראה', desc: 'אם המילה פלינדרום (זהה הפוך), ×10', cost: 7, icon: '🪞', rarity: 'uncommon' },
  { id: 'letter_13', name: 'מזל 13', desc: 'אות מ/ם (ערך 13) שווה ×4', cost: 5, icon: '🎰', rarity: 'uncommon' },
  
  // Rare (8-12₪)
  { id: 'five_stars', name: 'חמש כוכבים', desc: '5 אותיות: מכפיל כולל ×5', cost: 10, icon: '⭐', rarity: 'rare' },
  { id: 'first_last_same', name: 'התחלה וסוף', desc: 'אם האות הראשונה והאחרונה זהות: מכפיל ×8', cost: 9, icon: '🔄', rarity: 'rare' },
  { id: 'three_in_row', name: 'שלישייה', desc: 'אם יש 3 אותיות זהות במילה: מכפיל ×12', cost: 10, icon: '🎯', rarity: 'rare' },
  { id: 'prime_number', name: 'מספר ראשוני', desc: 'אם סכום המילה ראשוני: מכפיל ×7', cost: 8, icon: '🔢', rarity: 'rare' },
  { id: 'vowel_heavy', name: 'מלא תנועות', desc: 'אם יותר מחצי מהאותיות הן א/ו/י: מכפיל ×6', cost: 9, icon: '🎵', rarity: 'rare' },
  { id: 'double_mult', name: 'המכפיל הכפול', desc: 'מכפיל בסיסי ×2 לכל המכפיל הנוכחי', cost: 10, icon: '✖️✖️', rarity: 'rare' },
  { id: 'gematria', name: 'גימטריה', desc: 'סכום מתחלק ב-7: מכפיל ×20', cost: 10, icon: '7️⃣', rarity: 'rare' },
  { id: 'round_numbers', name: 'מספרים עגולים', desc: 'סכום עשרות שלמות (10,20...): מכפיל ×15', cost: 9, icon: '🎯', rarity: 'rare' },
  { id: 'personal_best', name: 'שיא אישי', desc: 'שיא ניקוד חדש בסיבוב: מכפיל ×3', cost: 10, icon: '🏆', rarity: 'rare' },
  { id: 'streak', name: 'רצף מנצח', desc: '3+ מילים ברצף ללא זריקה: מכפיל ×5', cost: 8, icon: '🔥', rarity: 'rare' },
  { id: 'combo', name: 'קומבו', desc: 'כל מילה מוסיפה +0.5 למכפיל (מצטבר בשלב)', cost: 9, icon: '🎯', rarity: 'rare' },
  { id: 'hand_master', name: 'מאסטר הידיים', desc: '+2 ידיים לכל שלב', cost: 12, icon: '🙌', rarity: 'rare' },
  { id: 'discard_master', name: 'מאסטר הזריקות', desc: '+2 זריקות לכל שלב', cost: 11, icon: '♻️', rarity: 'rare' },
  { id: 'chip_boost', name: 'מאיץ צ׳יפס', desc: '+100 צ׳יפס לכל מילה', cost: 8, icon: '🪙', rarity: 'rare' },
  { id: 'mult_boost', name: 'מאיץ מכפיל', desc: '+2 מכפיל לכל מילה', cost: 9, icon: '⚡', rarity: 'rare' },
  
  // Legendary (15-20₪)
  { id: 'word_changer', name: 'משנה מילים', desc: 'כל מילה = 5 אותיות', cost: 18, icon: '🎭', rarity: 'legendary' },
  { id: 'golden_touch', name: 'מגע הזהב', desc: 'כל אות ×5', cost: 20, icon: '👑', rarity: 'legendary' },
  { id: 'time_lord', name: 'אדון הזמן', desc: '10 מילים ברצף → ×50', cost: 15, icon: '⏰', rarity: 'legendary' },
  { id: 'destiny', name: 'הגורל', desc: '5% סיכוי ל-×100', cost: 15, icon: '🎰', rarity: 'legendary' },
  { id: 'holy_word', name: 'מילה קדושה', desc: 'א+מ+ש במילה → ×77', cost: 18, icon: '✨', rarity: 'legendary' },
  { id: 'infinite_hands', name: 'ידיים אינסופיות', desc: '+3 ידיים לכל Blind', cost: 20, icon: '♾️', rarity: 'legendary' },
  { id: 'super_wildcard', name: 'סופר Wildcard', desc: 'Wildcard = האות הכי טובה', cost: 16, icon: '🌠', rarity: 'legendary' },
  { id: 'perfect_score', name: 'ניקוד מושלם', desc: 'אם מגיע בדיוק ליעד → ×2 כסף', cost: 15, icon: '💯', rarity: 'legendary' },
  { id: 'mega_combo', name: 'מגה קומבו', desc: 'כל מילה מוסיפה +1 למכפיל (ללא הגבלה!)', cost: 18, icon: '🚀', rarity: 'legendary' },
  { id: 'wild_master', name: 'מאסטר הג׳וקר', desc: 'כל Wildcard שווה 25 נקודות', cost: 16, icon: '🌟', rarity: 'legendary' },
  { id: 'all_letters_bonus', name: 'מלון מלא', desc: 'אם כל האותיות ביד שונות, ×20', cost: 15, icon: '🎨', rarity: 'legendary' },
  
  // 🌈 ג'וקרים מבוססי צבע
  { id: 'rainbow', name: 'צבעי הקשת', desc: 'אם יש אותיות מכל 4 הצבעים במילה: מכפיל כולל ×3', cost: 8, icon: '🌈', rarity: 'rare' },
  { id: 'red_power', name: 'כוח אדום', desc: 'כל אות אדומה: ערך האות ×2 (לפני חישוב)', cost: 5, icon: '🔴', rarity: 'uncommon' },
  { id: 'blue_power', name: 'כוח כחול', desc: 'כל אות כחולה: ערך האות ×2 (לפני חישוב)', cost: 5, icon: '🔵', rarity: 'uncommon' },
  { id: 'yellow_power', name: 'כוח צהוב', desc: 'כל אות צהובה: ערך האות ×2 (לפני חישוב)', cost: 5, icon: '🟡', rarity: 'uncommon' },
  { id: 'green_power', name: 'כוח ירוק', desc: 'כל אות ירוקה: ערך האות ×2 (לפני חישוב)', cost: 5, icon: '🟢', rarity: 'uncommon' },
  { id: 'monochrome', name: 'חד-גוני', desc: 'אם כל המילה באותו צבע (3+ אותיות): מכפיל כולל ×5', cost: 7, icon: '🎨', rarity: 'uncommon' },
  { id: 'color_pair', name: 'זוג צבעים', desc: 'בדיוק 2 צבעים שונים במילה: +30 צ׳יפס לסך הכולל', cost: 6, icon: '🎭', rarity: 'uncommon' },
  { id: 'primary_colors', name: 'צבעים ראשוניים', desc: 'אדום+כחול+צהוב במילה: מכפיל כולל ×4', cost: 9, icon: '🎨', rarity: 'rare' },
  
  // 💰 ג'וקרים כלכליים
  { id: 'thrifty', name: 'חסכן', desc: 'כל זריקה שנשארת: +2₪ בסוף השלב', cost: 6, icon: '🏦', rarity: 'uncommon' },
  { id: 'efficient', name: 'יעיל', desc: 'כל יד שנשארת: +3₪ בסוף השלב', cost: 7, icon: '💼', rarity: 'uncommon' },
  { id: 'big_spender', name: 'בזבזן', desc: 'אם מסיימים שלב עם 0₪: +10₪', cost: 8, icon: '🤑', rarity: 'rare' },
  { id: 'banker', name: 'בנקאי', desc: '+1₪ לכל 10 נקודות', cost: 10, icon: '🏛️', rarity: 'rare' },
  { id: 'lucky_money', name: 'מזל עשירים', desc: '10% סיכוי: +5₪ אחרי כל מילה', cost: 7, icon: '🍀', rarity: 'uncommon' },
  { id: 'money_maker', name: 'עושה כסף', desc: '+1₪ אחרי כל מילה שמשחקים', cost: 9, icon: '💵', rarity: 'rare' },
  
  // 🎁 ג'וקרים מיוחדים נוספים
  { id: 'palindrome_bonus', name: 'מראה כפולה', desc: 'פלינדרום: מכפיל ×8 + +20 צ׳יפס', cost: 8, icon: '🪞', rarity: 'rare' },
  { id: 'alternating', name: 'סירוגין', desc: 'ערכים עולים ויורדים לסירוגין: +40 צ׳יפס', cost: 7, icon: '〰️', rarity: 'uncommon' },
  { id: 'sum_ten', name: 'סך עשרה', desc: 'כל אות ששווה 10 בדיוק: ×3 לאות', cost: 6, icon: '🔟', rarity: 'uncommon' },
  { id: 'word_length_bonus', name: 'מחשב מילים', desc: 'מילה שווה: 2×=+10, 3×=+25, 4×=+50, 5×=+100', cost: 8, icon: '📊', rarity: 'uncommon' },
  { id: 'repeater', name: 'חוזר', desc: 'אם שיחקת אותה אות 2+ פעמים בשלב: +15 לכל חזרה', cost: 7, icon: '🔁', rarity: 'uncommon' },
  { id: 'underdog', name: 'עולה מסלע', desc: 'אם בניקוד < 50% מהיעד: מכפיל ×2', cost: 8, icon: '💪', rarity: 'rare' },
  { id: 'overachiever', name: 'שאפתן', desc: 'אם מגיע ל-150%+ מהיעד: +15₪', cost: 12, icon: '🎯', rarity: 'legendary' },

  // 🆕 ג'וקרים חדשים!
  { id: 'snowball', name: 'כדור שלג', desc: 'כל 3 מילים ברצף: +5 למכפיל הקבוע', cost: 14, icon: '☃️', rarity: 'legendary' },
  { id: 'tax_collector', name: 'גבאי מס', desc: 'כל אות שנזרקת מוסיפה +3 נקודות (אוסף "מס")', cost: 9, icon: '📋', rarity: 'rare' },
  { id: 'twin_letters', name: 'תאומי אותיות', desc: 'אות שמופיעה פעמיים ביד: ×3 לכל אות כפולה', cost: 11, icon: '👯', rarity: 'rare' },
  { id: 'lazy_joker', name: 'ג׳וקר עצלן', desc: 'לא השתמשת בזריקה? כל יד: +20 נקודות', cost: 8, icon: '😴', rarity: 'uncommon' },
  { id: 'sharp_mind', name: 'חשיבה חדה', desc: 'כל 5 מילים: +1 קבוע למכפיל הבסיסי (צובר!)', cost: 16, icon: '🧠', rarity: 'legendary' },
  { id: 'coin_flip', name: 'הטלת מטבע', desc: '50% לכל מילה: ×3 מכפיל או +0 (מזל!)', cost: 6, icon: '🪙', rarity: 'uncommon' },
  { id: 'echo', name: 'הד', desc: 'האות האחרונה מוסיפה ×2 גם לאות הראשונה', cost: 10, icon: '🔊', rarity: 'rare' },
  { id: 'fibonacci', name: 'פיבונאצ׳י', desc: 'אם ערכי האותיות הם סדרת פיבונאצ׳י: ×15!', cost: 13, icon: '🌀', rarity: 'legendary' },
  { id: 'letter_thief', name: 'גנב אותיות', desc: 'לאחר כל מילה: האות הכי יקרה ביד שווה ×2 בפעם הבאה', cost: 12, icon: '🦝', rarity: 'rare' },
  { id: 'final_power', name: 'כוח סופי', desc: 'האות הסופית של המילה (ה-ן,ם,ף,ך,ץ): ×5', cost: 10, icon: '🏁', rarity: 'rare' },
  { id: 'lucky_alef', name: 'אלף מזל', desc: 'אם יש א במילה: +30 נקודות נוספות', cost: 7, icon: 'א', rarity: 'uncommon' },
  { id: 'word_doubler', name: 'מכפיל מילים', desc: 'כל 4 מילים: המילה הבאה שווה ×2', cost: 15, icon: '×2', rarity: 'legendary' },
  { id: 'perfect_symmetry', name: 'סימטריה מושלמת', desc: 'מילה בת 4: ×2 אם האות הראשונה=האחרונה', cost: 9, icon: '⚖️', rarity: 'rare' },
];

const UPGRADES = [
  { id: 'gold', name: 'זהב', desc: '×2 לערך', cost: 5, icon: '🥇' },
  { id: 'diamond', name: 'יהלום', desc: '×3 לערך', cost: 10, icon: '💎' },
  { id: 'plus', name: 'בונוס +10', desc: '+10 לערך', cost: 4, icon: '➕' },
];

const VOUCHERS = [
  { id: 'sixth_joker',    name: 'הג׳וקר השישי',   desc: '+1 מקום לג׳וקר (מקסימום 6)',    cost: 10, icon: '🎴', type: 'joker_slot' },
  { id: 'seventh_joker',  name: 'הג׳וקר השביעי',  desc: '+1 מקום נוסף (מקסימום 7)',      cost: 15, icon: '🃏', type: 'joker_slot', requires: 'sixth_joker' },
  { id: 'eighth_joker',   name: 'הג׳וקר השמיני',  desc: '+1 מקום נוסף (מקסימום 8)',      cost: 20, icon: '🎰', type: 'joker_slot', requires: 'seventh_joker' },
  { id: 'bigger_hand',    name: 'יד גדולה',       desc: '+2 קלפים ביד (10 במקום 8)',     cost: 12, icon: '🤲', type: 'hand_size' },
  { id: 'huge_hand',      name: 'יד ענקית',       desc: '+2 קלפים נוספים (12 קלפים!)',   cost: 18, icon: '👐', type: 'hand_size', requires: 'bigger_hand' },
  { id: 'extra_hand',     name: 'יד נוספת',       desc: '+1 יד קבועה לכל Blind',         cost: 8,  icon: '✋', type: 'extra_hands' },
  { id: 'extra_hand2',    name: 'שתי ידיים',      desc: '+1 יד נוספת (סה"כ +2)',         cost: 12, icon: '🙌', type: 'extra_hands', requires: 'extra_hand' },
  { id: 'extra_discard',  name: 'זריקה נוספת',    desc: '+1 זריקה קבועה לכל Blind',      cost: 7,  icon: '🔄', type: 'extra_discards' },
  { id: 'extra_discard2', name: 'שתי זריקות',     desc: '+1 זריקה נוספת (סה"כ +2)',      cost: 10, icon: '♻️', type: 'extra_discards', requires: 'extra_discard' },
  { id: 'interest',       name: 'ריבית',          desc: '+1₪ לכל 5₪ בסוף שלב (עד 5₪)',  cost: 10, icon: '🏦', type: 'interest' },
  { id: 'interest2',      name: 'ריבית מורכבת',  desc: '+1₪ לכל 4₪ (עד 10₪!)',          cost: 15, icon: '📈', type: 'interest2', requires: 'interest' },
  { id: 'shop_discount',  name: 'הנחה בחנות',    desc: '-1₪ על כל פריט בחנות',          cost: 8,  icon: '🏷️', type: 'discount' },
  { id: 'reroll_discount',name: 'רענון זול',      desc: 'רענון חינם אחד בכל ביקור בחנות', cost: 6, icon: '🔃', type: 'free_reroll' },
  { id: 'card_prices',    name: 'ממחיר קלפים',   desc: 'קלפים רגילים בחנות עולים 0₪',   cost: 9,  icon: '🆓', type: 'free_cards' },
  { id: 'extra_card_shop',name: 'חנות מורחבת',   desc: '+1 קלף נוסף בכל חנות',           cost: 11, icon: '🛒', type: 'extra_shop_card' },
  { id: 'mega_scout',     name: 'חוקר ענק',      desc: '4 ג׳וקרים בחנות (במקום 3)',      cost: 13, icon: '🔭', type: 'extra_joker_shop' },
  { id: 'voucher_master', name: 'אדון הבונוסים', desc: '3 בונוסים בחנות (במקום 2)',       cost: 14, icon: '🎁', type: 'extra_voucher_shop' },
];

const DIFFICULTIES = {
  easy: { 
    name: 'קל', 
    icon: '😊', 
    scoreMultiplier: 0.7, 
    moneyMultiplier: 1.3,
    startMoney: 6,
    color: 'from-green-600 to-green-800',
    desc: 'יעדים נמוכים, יותר כסף'
  },
  normal: { 
    name: 'רגיל', 
    icon: '😐', 
    scoreMultiplier: 1, 
    moneyMultiplier: 1,
    startMoney: 4,
    color: 'from-blue-600 to-blue-800',
    desc: 'איזון מושלם'
  },
  hard: { 
    name: 'קשה', 
    icon: '😰', 
    scoreMultiplier: 1.4, 
    moneyMultiplier: 0.8,
    startMoney: 3,
    color: 'from-orange-600 to-orange-800',
    desc: 'יעדים גבוהים, פחות כסף'
  },
  expert: { 
    name: 'מומחה', 
    icon: '😱', 
    scoreMultiplier: 2, 
    moneyMultiplier: 0.6,
    startMoney: 2,
    color: 'from-red-600 to-red-800',
    desc: 'אתגר אולטימטיבי!'
  },
};

const BOSS_BLINDS = [
  { id: 'censor', name: 'הצנזור', desc: '🚫 אסור להשתמש באותיות ס ו-ע', icon: '🚫' },
  { id: 'long_only', name: 'רק ארוכות', desc: '📏 חייבים לשחק רק מילים של 4-5 אותיות', icon: '📏' },
  { id: 'no_discards', name: 'ללא זריקות', desc: '⛔ אין זריקות בכלל! (0 זריקות)', icon: '⛔' },
  { id: 'expensive', name: 'היקר', desc: '💸 כל קלף שווה רק 5 נקודות (ולא ערכו המלא)', icon: '💸' },
  { id: 'short_only', name: 'רק קצרות', desc: '📐 חייבים לשחק רק מילים של 2-3 אותיות', icon: '📐' },
  { id: 'no_finals', name: 'ללא סופיות', desc: '🔒 אסור להשתמש באותיות סופיות: ך ם ן ף ץ', icon: '🔒' },
  { id: 'few_hands', name: 'מעט ידיים', desc: '✋ רק 2 ידיים לשחק במקום 4!', icon: '✋' },
  { id: 'weak_letters', name: 'אותיות חלשות', desc: '🔴 אסור להשתמש באותיות א ב ג ד ה', icon: '🔴' },
  { id: 'no_mult', name: 'ללא מכפילים', desc: '⭕ ג׳וקרים שנותנים מכפיל (×) לא עובדים', icon: '⭕' },
  { id: 'half_score', name: 'חצי ניקוד', desc: '📉 כל מילה מקבלת רק 50% מהנקודות', icon: '📉' },
  { id: 'expensive_shop', name: 'חנות יקרה', desc: '💰 כל פריט בחנות עולה פי 2', icon: '💰' },
  { id: 'time_limit', name: 'מגבלת זמן', desc: '⏱️ רק 3 ידיים במקום 4', icon: '⏱️' },
  { id: 'card_eater', name: 'אוכל קלפים', desc: '🗑️ קלפים שזורקים נעלמים לצמיתות מהחפיסה!', icon: '🗑️' },
  { id: 'final_boss', name: 'הבוס הסופי', desc: '👹 אסור ס/ע + אסור סופיות + 0 זריקות!', icon: '👹' },
];

const BLIND_CONFIGS = {
  small: {
    name: 'שלב קטן',
    icon: '🟢',
    scoreMultiplier: 1,
    reward: 3,
    hands: 4,
    discards: 3
  },
  big: {
    name: 'שלב גדול',
    icon: '🟡',
    scoreMultiplier: 1.67,
    reward: 4,
    hands: 4,
    discards: 3
  },
  boss: {
    name: 'שלב בוס',
    icon: '🔴',
    scoreMultiplier: 2,
    reward: 5,
    hands: 4,
    discards: 3
  }
};

// ===============================
// פונקציות עזר
// ===============================

function createDeck() {
  const letters = 'אבגדהוזחטיכלמנסעפצקרשת';
  const finals = 'ךםןףץ';
  const deck = [];
  
  for (let letter of letters) {
    const color = LETTER_COLORS[letter];
    deck.push({ letter, value: LETTER_VALUES[letter], color, id: Math.random(), upgrades: [] });
    deck.push({ letter, value: LETTER_VALUES[letter], color, id: Math.random(), upgrades: [] });
  }
  
  for (let letter of finals) {
    const color = LETTER_COLORS[letter];
    deck.push({ letter, value: LETTER_VALUES[letter], color, id: Math.random(), upgrades: [] });
  }
  
  for (let i = 0; i < 3; i++) {
    deck.push({ letter: '*', value: 0, color: 'rainbow', id: Math.random(), upgrades: [], isWildcard: true });
  }
  
  return shuffleArray(deck);
}

function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

function getCardValue(card) {
  let value = card.value;
  if (card.upgrades?.includes('gold')) value *= 2;
  if (card.upgrades?.includes('diamond')) value *= 3;
  if (card.upgrades?.includes('plus')) value += 10;
  return Math.floor(value);
}

function calculateScore(cards, jokers, bossBlind, megaComboMult = 1) {
  /* 
  📊 הסבר מערכת הניקוד:
  
  1. ערך בסיסי של אותיות: א=1, ב=2, ... ת=22
  2. בונוס בסיס לפי אורך מילה:
     - 2 אותיות: +10 צ'יפס, ×1 מכפיל
     - 3 אותיות: +20 צ'יפס, ×2 מכפיל
     - 4 אותיות: +40 צ'יפס, ×4 מכפיל
     - 5 אותיות: +60 צ'יפס, ×5 מכפיל
  
  3. נוסחה סופית: (סכום אותיות + בונוס בסיס) × מכפיל
  
  דוגמה: "שלום" (5 אותיות)
  - ש(21) + ל(12) + ו(6) + ם(13) = 52
  - בונוס בסיס: +60
  - סה"כ צ'יפס: 112
  - מכפיל: ×5
  - ניקוד: 112 × 5 = 560 נקודות!
  */
  
  let chips = 0;
  let mult = 1;
  let wordLength = cards.length;
  
  // בוס "משנה מילים" - כל מילה נחשבת ל-5
  const hasWordChanger = jokers.some(j => j.id === 'word_changer');
  if (hasWordChanger) {
    wordLength = 5;
  }
  
  // חישוב ערך אותיות
  cards.forEach((card, index) => {
    let value = getCardValue(card);
    
    // ⚠️ FIX: Wildcard מתחיל מ-0, אז תן לו ערך לפני הכל
    if (card.isWildcard && jokers.some(j => j.id === 'wildcard_lover')) {
      value = 10; // מתחיל מ-10 במקום 0
    }
    
    // ג'וקרים שמשפיעים על אותיות בודדות
    jokers.forEach(joker => {
      if (joker.id === 'bgdkft' && ['ב','ג','ד','כ','ך','פ','ף','ת'].includes(card.letter)) {
        value *= 1.5;
      }
      if (joker.id === 'heavy' && ['ק','ר','ש','ת'].includes(card.letter)) {
        value *= 2;
      }
      if (joker.id === 'first10' && card.value >= 1 && card.value <= 10) {
        value += 5;
      }
      if (joker.id === 'middle' && card.value >= 11 && card.value <= 16) {
        value += 8;
      }
      if (joker.id === 'vowels' && ['א','ו','י'].includes(card.letter)) {
        value += 3;
      }
      if (joker.id === 'golden_finals' && ['ך','ם','ן','ף','ץ'].includes(card.letter)) {
        value *= 3;
      }
      if (joker.id === 'big_head' && index === 0) {
        value *= 4;
      }
      if (joker.id === 'happy_end' && index === cards.length - 1) {
        value *= 4;
      }
      if (joker.id === 'middle_king' && index === Math.floor(cards.length / 2)) {
        value *= 5;
      }
      if (joker.id === 'alphabet') {
        value += 2;
      }
      if (joker.id === 'wildcard_lover' && card.isWildcard) {
        // כבר קיבל 10, עכשיו ×10 = 100
        value *= 10;
      }
      if (joker.id === 'golden_touch') {
        value *= 5;
      }
      // 🌈 ג'וקרי צבעים - מכפילים על ערך האות
      if (joker.id === 'red_power' && card.color === 'red') {
        value *= 2;
      }
      if (joker.id === 'blue_power' && card.color === 'blue') {
        value *= 2;
      }
      if (joker.id === 'yellow_power' && card.color === 'yellow') {
        value *= 2;
      }
      if (joker.id === 'green_power' && card.color === 'green') {
        value *= 2;
      }
    });
    
    chips += value;
  });
  
  // בונוס בסיס
  const baseChips = { 2: 10, 3: 20, 4: 40, 5: 60 }[wordLength] || 10;
  const baseMult = { 2: 1, 3: 2, 4: 4, 5: 5 }[wordLength] || 1;
  
  chips += baseChips;
  mult = baseMult;
  
  // ג'וקרים שנותנים בונוס צ'יפס
  jokers.forEach(joker => {
    if (joker.id === 'short_words' && cards.length <= 3) {
      chips += 25;
    }
    if (joker.id === 'chip_boost') {
      chips += 100;
    }
    if (joker.id === 'mult_boost') {
      mult += 2;
    }
  });
  
  // בדיקות מיוחדות
  const letterCount = {};
  cards.forEach(c => {
    if (!c.isWildcard) {
      letterCount[c.letter] = (letterCount[c.letter] || 0) + 1;
    }
  });
  const hasDouble = Object.values(letterCount).some(count => count >= 2);
  const uniqueCount = Object.keys(letterCount).length;
  const letterSum = cards.reduce((sum, c) => sum + c.value, 0);
  
  jokers.forEach(joker => {
    if (joker.id === 'doubles' && hasDouble) {
      chips += 20;
    }
    if (joker.id === 'neighbor') {
      for (let i = 0; i < cards.length - 1; i++) {
        if (cards[i].letter === cards[i+1].letter) {
          chips += 15;
          break;
        }
      }
    }
    if (joker.id === 'collector') {
      chips += uniqueCount * 10;
    }
    if (joker.id === 'leap') {
      for (let i = 0; i < cards.length - 1; i++) {
        if (Math.abs(cards[i].value - cards[i+1].value) >= 10) {
          chips += 50;
          break;
        }
      }
    }
    if (joker.id === 'balance' && letterSum % 2 === 0) {
      chips += 25;
    }
    if (joker.id === 'lucky_7' && letterSum % 7 === 0) {
      mult *= 3;
    }
    if (joker.id === 'five_stars' && wordLength === 5) {
      mult *= 5;
    }
    if (joker.id === 'double_mult') {
      mult *= 2;
    }
    if (joker.id === 'gematria' && letterSum % 7 === 0) {
      mult *= 20;
    }
    if (joker.id === 'round_numbers' && [10,20,30,40,50,60,70,80,90,100].includes(letterSum)) {
      mult *= 15;
    }
    if (joker.id === 'rising') {
      let isRising = true;
      for (let i = 1; i < cards.length; i++) {
        if (cards[i].value <= cards[i-1].value) {
          isRising = false;
          break;
        }
      }
      if (isRising) mult *= 10;
    }
    if (joker.id === 'falling') {
      let isFalling = true;
      for (let i = 1; i < cards.length; i++) {
        if (cards[i].value >= cards[i-1].value) {
          isFalling = false;
          break;
        }
      }
      if (isFalling) mult *= 10;
    }
    if (joker.id === 'holy_word') {
      const hasAlef = cards.some(c => c.letter === 'א');
      const hasMem = cards.some(c => c.letter === 'מ' || c.letter === 'ם');
      const hasShin = cards.some(c => c.letter === 'ש');
      if (hasAlef && hasMem && hasShin) {
        mult *= 77;
      }
    }
    if (joker.id === 'destiny' && Math.random() < 0.05) {
      mult *= 100;
    }
    
    // ג'וקרים חדשים שהוספנו
    if (joker.id === 'even_odd') {
      const hasEven = cards.some(c => c.value % 2 === 0);
      const hasOdd = cards.some(c => c.value % 2 === 1);
      if (hasEven && hasOdd) {
        chips += 30;
      }
    }
    if (joker.id === 'mirror') {
      const word = cards.map(c => c.letter).join('');
      const reversed = cards.map(c => c.letter).reverse().join('');
      if (word === reversed && word.length >= 2) {
        mult *= 10;
      }
    }
    if (joker.id === 'letter_13') {
      cards.forEach(c => {
        if (c.letter === 'מ' || c.letter === 'ם') {
          chips += c.value * 3; // ×4 total (already counted once)
        }
      });
    }
    if (joker.id === 'first_last_same') {
      if (cards.length >= 2 && cards[0].letter === cards[cards.length-1].letter) {
        mult *= 8;
      }
    }
    if (joker.id === 'three_in_row') {
      const hasThree = Object.values(letterCount).some(count => count >= 3);
      if (hasThree) {
        mult *= 12;
      }
    }
    if (joker.id === 'prime_number') {
      const isPrime = (n) => {
        if (n < 2) return false;
        for (let i = 2; i <= Math.sqrt(n); i++) {
          if (n % i === 0) return false;
        }
        return true;
      };
      if (isPrime(letterSum)) {
        mult *= 7;
      }
    }
    if (joker.id === 'vowel_heavy') {
      const vowelCount = cards.filter(c => ['א','ו','י'].includes(c.letter)).length;
      if (vowelCount > cards.length / 2) {
        mult *= 6;
      }
    }
    if (joker.id === 'mega_combo') {
      mult += megaComboMult; // מוסיף מכפיל שנצבר
    }
    if (joker.id === 'wild_master') {
      cards.forEach(c => {
        if (c.isWildcard) {
          chips += 25;
        }
      });
    }
    if (joker.id === 'all_letters_bonus') {
      // ספור אותיות ייחודיות (כולל wildcards)
      const uniqueLetters = new Set(cards.map(c => c.letter));
      const allDifferent = uniqueLetters.size === cards.length;
      if (allDifferent && cards.length >= 3) {
        mult *= 20;
      }
    }
    
    // 🌈 ג'וקרים מבוססי צבע (המכפלה כבר בוצעה למעלה בלולאה)
    if (joker.id === 'rainbow') {
      const colors = new Set(cards.map(c => c.color).filter(c => c !== 'rainbow'));
      if (colors.size === 4) { // כל 4 הצבעים
        mult *= 3;
      }
    }
    // red_power, blue_power, etc כבר עובדים בלולאה למעלה!
    if (joker.id === 'monochrome') {
      const colors = new Set(cards.map(c => c.color).filter(c => c !== 'rainbow'));
      if (colors.size === 1 && cards.length >= 3) {
        mult *= 5;
      }
    }
    if (joker.id === 'color_pair') {
      const colors = new Set(cards.map(c => c.color).filter(c => c !== 'rainbow'));
      if (colors.size === 2) {
        chips += 30;
      }
    }
    if (joker.id === 'primary_colors') {
      const colors = cards.map(c => c.color);
      const hasRed = colors.includes('red');
      const hasBlue = colors.includes('blue');
      const hasYellow = colors.includes('yellow');
      if (hasRed && hasBlue && hasYellow) {
        mult *= 4;
      }
    }
    
    // 🆕 ג'וקרים חדשים
    if (joker.id === 'twin_letters') {
      Object.entries(letterCount).forEach(([letter, count]) => {
        if (count >= 2) {
          chips += (LETTER_VALUES[letter] || 1) * 3 * (count - 1);
        }
      });
    }
    if (joker.id === 'lazy_joker' && streakCount > 0) {
      chips += 20;
    }
    if (joker.id === 'coin_flip') {
      if (Math.random() < 0.5) mult *= 3;
    }
    if (joker.id === 'echo' && cards.length >= 2) {
      chips += getCardValue(cards[0]) * 2;
    }
    if (joker.id === 'fibonacci') {
      const fibs = new Set([1, 2, 3, 5, 8, 13, 21]);
      const allFib = cards.every(c => fibs.has(c.value));
      if (allFib && cards.length >= 3) mult *= 15;
    }
    if (joker.id === 'final_power') {
      const lastCard = cards[cards.length - 1];
      if (lastCard && ['ן','ם','ף','ך','ץ'].includes(lastCard.letter)) {
        chips += getCardValue(lastCard) * 4;
      }
    }
    if (joker.id === 'lucky_alef' && cards.some(c => c.letter === 'א')) {
      chips += 30;
    }
    if (joker.id === 'perfect_symmetry' && cards.length === 4) {
      if (cards[0].letter === cards[3].letter) mult *= 2;
    }
    if (joker.id === 'word_length_bonus') {
      const bonusMap = { 2: 10, 3: 25, 4: 50, 5: 100 };
      chips += bonusMap[wordLength] || 0;
    }
  });
  
  // בוס "היקר"
  if (bossBlind?.id === 'expensive') {
    return cards.length * 10;
  }
  
  return Math.floor(chips * mult);
}

function validateBossChallenge(cards, bossBlind) {
  if (!bossBlind) return { valid: true };
  
  const word = cards.map(c => c.letter).join('');
  
  switch (bossBlind.id) {
    case 'censor':
      if (word.includes('ס') || word.includes('ע')) {
        return { valid: false, reason: 'אסור להשתמש באותיות ס או ע!' };
      }
      break;
    case 'long_only':
      if (cards.length < 4) {
        return { valid: false, reason: 'רק מילים בנות 4-5 אותיות!' };
      }
      break;
    case 'short_only':
      if (cards.length > 3) {
        return { valid: false, reason: 'רק מילים בנות 2-3 אותיות!' };
      }
      break;
    case 'no_finals':
      if (cards.some(c => ['ך','ם','ן','ף','ץ'].includes(c.letter))) {
        return { valid: false, reason: 'אסור באותיות סופיות!' };
      }
      break;
    case 'weak_letters':
      if (cards.some(c => ['א','ב','ג','ד','ה'].includes(c.letter))) {
        return { valid: false, reason: 'אסור להשתמש באותיות א ב ג ד ה!' };
      }
      break;
    case 'expensive':
      break;
    case 'final_boss':
      if (word.includes('ס') || word.includes('ע')) {
        return { valid: false, reason: 'אסור ס/ע (בוס סופי)!' };
      }
      if (cards.some(c => ['ך','ם','ן','ף','ץ'].includes(c.letter))) {
        return { valid: false, reason: 'אסור סופיות (בוס סופי)!' };
      }
      break;
  }
  
  return { valid: true };
}

// ===============================
// קומפוננטות
// ===============================

function Card({ card, onClick, selected, inHand }) {
  const hasUpgrades = card.upgrades && card.upgrades.length > 0;
  const isWildcard = card.isWildcard;
  const colorStyle = COLOR_STYLES[card.color] || COLOR_STYLES.rainbow;
  
  return (
    <div
      onClick={onClick}
      className={`
        relative w-16 h-24 md:w-20 md:h-28 rounded-lg md:rounded-xl border-2 md:border-4 flex flex-col items-center justify-center 
        transition-all duration-300 select-none
        bg-gradient-to-br ${colorStyle.gradient}
        ${selected ? 'border-blue-500 -translate-y-6 md:-translate-y-8 shadow-2xl scale-110' : hasUpgrades ? 'border-yellow-500 shadow-lg shadow-yellow-500/40' : `${colorStyle.border} shadow-lg ${colorStyle.shadow}`}
        ${inHand ? 'cursor-pointer hover:-translate-y-3 md:hover:-translate-y-4 hover:shadow-2xl hover:scale-105' : 'cursor-default'}
      `}
      style={{
        boxShadow: selected ? '0 20px 60px rgba(59, 130, 246, 0.8), 0 0 40px rgba(59, 130, 246, 0.6)' : 
                   hasUpgrades ? '0 10px 30px rgba(255, 215, 0, 0.4)' : undefined
      }}
    >
      {/* רקע מעוצב */}
      <div className="absolute inset-0 opacity-10 rounded-lg md:rounded-xl overflow-hidden">
        <div className="absolute inset-0" style={{
          backgroundImage: 'radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px)',
          backgroundSize: '10px 10px'
        }} />
      </div>

      {/* אייקוני שדרוג */}
      {hasUpgrades && (
        <div className="absolute -top-1 -right-1 md:-top-2 md:-right-2 flex gap-0.5 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full p-1 md:p-1.5 shadow-lg animate-pulse z-10">
          {card.upgrades.map((upg, i) => {
            const upgrade = UPGRADES.find(u => u.id === upg);
            return upgrade ? (
              <span key={i} className="text-xs md:text-base filter drop-shadow-lg">{upgrade.icon}</span>
            ) : null;
          })}
        </div>
      )}
      
      {/* אייקון צבע */}
      <div className="absolute top-0.5 left-0.5 md:top-1 md:left-1 text-sm md:text-lg opacity-70">
        {colorStyle.icon}
      </div>
      
      {/* האות */}
      <div className={`text-3xl md:text-5xl font-bold relative z-10 ${colorStyle.text}`}
           style={{ textShadow: '2px 2px 4px rgba(0,0,0,0.15)' }}>
        {card.letter}
      </div>
      
      {/* הערך */}
      <div className={`text-sm md:text-xl font-bold mt-0.5 md:mt-1 px-1.5 md:px-2 py-0.5 rounded-full ${
        hasUpgrades ? 'bg-gradient-to-r from-yellow-400 to-orange-400 text-white shadow-md' : 
        `bg-white/50 ${colorStyle.text}`
      }`} style={{ textShadow: '1px 1px 2px rgba(0,0,0,0.1)' }}>
        {isWildcard ? '★' : getCardValue(card)}
      </div>

      {/* אפקט זוהר כשנבחר */}
      {selected && (
        <div className="absolute inset-0 bg-gradient-to-br from-white/30 via-transparent to-transparent rounded-lg md:rounded-xl pointer-events-none" />
      )}
    </div>
  );
}

function JokerCard({ joker, onClick, canBuy, small }) {
  const rarityColors = {
    common: 'from-gray-600 to-gray-800',
    uncommon: 'from-green-600 to-green-800',
    rare: 'from-blue-600 to-blue-800',
    legendary: 'from-purple-600 to-purple-900'
  };

  return (
    <div
      onClick={canBuy ? onClick : undefined}
      className={`
        ${small ? 'p-2' : 'p-4'} bg-gradient-to-br ${rarityColors[joker.rarity]}
        rounded-lg border-2 border-white/20 ${small ? 'min-w-[100px]' : 'min-w-[140px]'} 
        transition-all duration-200
        ${canBuy ? 'cursor-pointer hover:border-white/50 hover:scale-105 hover:shadow-xl' : canBuy === undefined ? '' : 'opacity-50 cursor-not-allowed'}
      `}
    >
      <div className={`${small ? 'text-2xl' : 'text-3xl'} mb-1`}>{joker.icon}</div>
      <div className={`font-bold ${small ? 'text-xs' : 'text-sm'}`}>{joker.name}</div>
      <div className={`text-xs text-white/80 ${small ? 'text-[10px]' : 'mt-1'}`}>{joker.desc}</div>
      {canBuy !== undefined && (
        <div className={`text-yellow-400 font-bold ${small ? 'text-sm mt-1' : 'mt-2'}`}>{joker.cost}₪</div>
      )}
    </div>
  );
}

function Confetti() {
  return (
    <div className="fixed inset-0 pointer-events-none z-50">
      {[...Array(30)].map((_, i) => (
        <div
          key={i}
          className="absolute animate-[fall_2s_ease-out_forwards]"
          style={{
            left: `${Math.random() * 100}%`,
            top: '-20px',
            animationDelay: `${i * 50}ms`,
            width: '10px',
            height: '10px',
            background: ['#FFD700', '#FF69B4', '#87CEEB', '#98FB98'][Math.floor(Math.random() * 4)],
            transform: `rotate(${Math.random() * 360}deg)`
          }}
        />
      ))}
      <style>{`
        @keyframes fall {
          to {
            transform: translateY(100vh) rotate(360deg);
            opacity: 0;
          }
        }
      `}</style>
    </div>
  );
}

function Game() {
  const [gameMode, setGameMode] = useState('menu');
  const [kidsMode, setKidsMode] = useState(false);
  const [difficulty, setDifficulty] = useState('normal');
  const [needsApproval, setNeedsApproval] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);
  
  const [deck, setDeck] = useState([]);
  const [hand, setHand] = useState([]);
  const [handSize, setHandSize] = useState(8);
  const [selected, setSelected] = useState([]);
  const [score, setScore] = useState(0);
  const [targetScore, setTargetScore] = useState(300);
  const [money, setMoney] = useState(4);
  const [handsLeft, setHandsLeft] = useState(4);
  const [discardsLeft, setDiscardsLeft] = useState(3);
  const [baseHands, setBaseHands] = useState(4);
  const [baseDiscards, setBaseDiscards] = useState(3);
  const [ante, setAnte] = useState(1);
  const [blind, setBlind] = useState('small');
  const [currentBossBlind, setCurrentBossBlind] = useState(null);
  const [jokers, setJokers] = useState([]);
  const [maxJokers, setMaxJokers] = useState(5);
  const [megaComboMult, setMegaComboMult] = useState(1);
  const [wildcardPicker, setWildcardPicker] = useState(null); // { cardId, resolve }
  const [wildcardChosenLetter, setWildcardChosenLetter] = useState({}); // cardId -> letter
  const [vouchers, setVouchers] = useState([]);
  const [hasDiscount, setHasDiscount] = useState(false);
  const [hasFreeReroll, setHasFreeReroll] = useState(false);
  const [shuffledBosses, setShuffledBosses] = useState([]);
  
  const [shopJokers, setShopJokers] = useState([]);
  const [shopUpgrades, setShopUpgrades] = useState([]);
  const [shopVouchers, setShopVouchers] = useState([]);
  const [selectedUpgrade, setSelectedUpgrade] = useState(null);
  const [showScoreBreakdown, setShowScoreBreakdown] = useState(false);
  const [showDeckViewer, setShowDeckViewer] = useState(false);
  const [rerollUsedThisShop, setRerollUsedThisShop] = useState(false);
  const [jokerCounters, setJokerCounters] = useState({}); // עבור מגה קומבו, קומבו וכו'
  const [wildcardChoice, setWildcardChoice] = useState(null); // בחירת אות לכוכב
  const [showWildcardPicker, setShowWildcardPicker] = useState(false);
  const [streakCount, setStreakCount] = useState(0); // מונה רצף ללא זריקה
  const [letterUsedInBlind, setLetterUsedInBlind] = useState({}); // לג'וקר "חוזר"
  const [shopCards, setShopCards] = useState([]);
  const [confirmPurchase, setConfirmPurchase] = useState(null); // { type, item }
  const [showShopDeck, setShowShopDeck] = useState(false);
  const [jokerDetail, setJokerDetail] = useState(null); // for mobile tap detail

  const startGame = (kids = false, selectedDifficulty = 'normal') => {
    setKidsMode(kids);
    setDifficulty(selectedDifficulty);
    setNeedsApproval(false);
    setScore(0);
    
    // כסף לפי רמת קושי
    const diffConfig = DIFFICULTIES[selectedDifficulty];
    setMoney(diffConfig.startMoney);
    
    setAnte(1);
    setBlind('small');
    setJokers([]);
    setVouchers([]);
    setShowConfetti(false);
    setCurrentBossBlind(null);
    
    // ערבב אתגרי בוס באקראי!
    const bossList = [...BOSS_BLINDS];
    const finalBoss = bossList.pop(); // שמור את הבוס הסופי
    const shuffled = shuffleArray(bossList);
    shuffled.push(finalBoss); // הבוס הסופי תמיד אחרון
    setShuffledBosses(shuffled);
    
    // צור חפיסה חדשה
    const newDeck = createDeck();
    setDeck(newDeck);
    setHand([]);
    
    setGameMode('gameIntro');
  };

  const toggleCard = (card) => {
    if (needsApproval) return;
    
    if (selected.find(c => c.id === card.id)) {
      setSelected(selected.filter(c => c.id !== card.id));
    } else if (selected.length < 5) {
      setSelected([...selected, card]);
    }
  };

  const playHand = async () => {
    if (selected.length < 2 || selected.length > 5) return;

    // בדיקת אתגר בוס
    if (currentBossBlind) {
      const validation = validateBossChallenge(selected, currentBossBlind);
      if (!validation.valid) {
        alert('❌ ' + validation.reason);
        return;
      }
    }

    // 🌟 אם יש wildcards ביד ועדיין לא נבחרו אותיות לכולם — פתח בורר
    const wildcardCards = selected.filter(c => c.isWildcard);
    if (wildcardCards.length > 0) {
      const missingChoice = wildcardCards.find(c => !wildcardChosenLetter[c.id]);
      if (missingChoice) {
        setWildcardPicker({ cardId: missingChoice.id });
        setShowWildcardPicker(true);
        return; // ממתינים לבחירה
      }
    }

    // 📖 בדיקת מילה במילון (עם אותיות wildcards שנבחרו)
    const wordLetters = selected.map(c => {
      if (c.isWildcard && wildcardChosenLetter[c.id]) return wildcardChosenLetter[c.id];
      if (c.isWildcard && wildcardChoice) return wildcardChoice;
      return c.letter;
    });
    const word = wordLetters.join('');
    
    const validation = await validateHebrewWord(word);
    
    if (kidsMode) {
      if (validation.valid) {
        // מילה תקנית במצב ילדים — אפשר להמשיך ישירות!
        approveWord();
      } else {
        // מילה לא תקנית — צריך אישור הורה
        setNeedsApproval(true);
      }
    } else {
      if (!validation.valid) {
        console.log(`⚠️ "${word}" לא נמצאה במילון — ממשיכים בכל זאת`);
      }
      approveWord();
    }
  };

  const approveWord = () => {
    // אם יש wildcard עם אות שנבחרה - עדכן את הקלפים
    const cardsToScore = selected.map(c => {
      if (c.isWildcard) {
        const chosenLetter = wildcardChosenLetter[c.id] || wildcardChoice;
        if (chosenLetter) {
          return { ...c, letter: chosenLetter, value: LETTER_VALUES[chosenLetter] || 1, color: LETTER_COLORS[chosenLetter] || 'rainbow' };
        }
      }
      return c;
    });

    let points = calculateScore(cardsToScore, jokers, currentBossBlind, megaComboMult);
    
    // בוס "היקר"
    if (currentBossBlind?.id === 'expensive') {
      points = selected.length * 5 * (selected.length >= 5 ? 5 : selected.length >= 3 ? 2 : 1);
    }
    
    const newScore = score + points;
    setScore(newScore);
    
    // 📈 mega_combo - צובר מכפיל עם כל מילה
    if (jokers.some(j => j.id === 'mega_combo')) {
      setMegaComboMult(prev => prev + 1);
    }
    
    // 🔥 streak - מונה רצף ללא זריקה
    setStreakCount(prev => prev + 1);
    
    // 🔁 repeater - עוקב אחרי אותיות ששימשו
    const newLetterUsed = { ...letterUsedInBlind };
    cardsToScore.forEach(c => {
      if (!c.isWildcard) {
        newLetterUsed[c.letter] = (newLetterUsed[c.letter] || 0) + 1;
      }
    });
    setLetterUsedInBlind(newLetterUsed);
    
    // 💰 ג'וקרים כלכליים
    let bonusMoney = 0;
    if (jokers.some(j => j.id === 'banker')) bonusMoney += Math.floor(points / 10);
    if (jokers.some(j => j.id === 'lucky_money') && Math.random() < 0.1) bonusMoney += 5;
    if (jokers.some(j => j.id === 'money_maker')) bonusMoney += 1;
    if (bonusMoney > 0) setMoney(money + bonusMoney);
    
    // איפוס wildcard לכוכב שוב
    setWildcardChoice(null);
    setWildcardChosenLetter({});
    setWildcardPicker(null);
    
    // ⚠️ הקלפים שמשחקים חוזרים לחפיסה (wildcards חוזרים לצורתם המקורית)
    const newHand = hand.filter(c => !selected.find(s => s.id === c.id));
    const cardsToDrawCount = handSize - newHand.length;
    const newCards = deck.slice(0, cardsToDrawCount);
    setHand([...newHand, ...newCards]);
    
    // Wildcards חוזרים לחפיסה כ-wildcards רגילים (לא עם האות שנבחרה)
    const remainingDeck = deck.slice(cardsToDrawCount);
    setDeck([...remainingDeck, ...selected]);
    
    setSelected([]);
    const newHandsLeft = handsLeft - 1;
    setHandsLeft(newHandsLeft);
    setNeedsApproval(false);
    
    // אנימציית confetti
    setShowConfetti(true);
    setTimeout(() => setShowConfetti(false), 2000);
    
    if (newScore >= targetScore) {
      // ניצחון! תן כסף
      const config = BLIND_CONFIGS[blind];
      let reward = config.reward + Math.floor(newHandsLeft); // כסף עבור ידיים שנשארו
      
      // 💰 בונוסים מג'וקרים כלכליים
      if (jokers.some(j => j.id === 'thrifty')) {
        reward += discardsLeft * 2;
      }
      if (jokers.some(j => j.id === 'efficient')) {
        reward += newHandsLeft * 3;
      }
      if (jokers.some(j => j.id === 'big_spender') && money === 0) {
        reward += 10;
      }
      
      setMoney(money + bonusMoney + reward);
      
      setTimeout(() => {
        setGameMode('stageWin');
      }, 600);
    } else if (newHandsLeft <= 0) {
      setTimeout(() => {
        setGameMode('stageLoss');
      }, 600);
    }
  };

  const rejectWord = () => {
    setNeedsApproval(false);
    setSelected([]);
    const newHandsLeft = handsLeft - 1;
    setHandsLeft(newHandsLeft);
    
    if (newHandsLeft <= 0) {
      setTimeout(() => {
        setGameMode('stageLoss');
      }, 500);
    }
  };

  const discardCards = () => {
    if (selected.length === 0 || needsApproval || discardsLeft <= 0) return;
    
    const newHand = hand.filter(c => !selected.find(s => s.id === c.id));
    const newCards = deck.slice(0, selected.length);
    setHand([...newHand, ...newCards]);
    
    // ⚠️ בוס "אוכל קלפים" - קלפים זרוקים נעלמים לתמיד!
    if (currentBossBlind?.id === 'card_eater') {
      // אל תחזיר את הקלפים לחפיסה - פשוט מחק אותם!
      const remainingDeck = deck.slice(selected.length);
      setDeck(remainingDeck);
    } else {
      // החזר את הקלפים הזרוקים לתחתית החפיסה (רגיל)
      const remainingDeck = deck.slice(selected.length);
      setDeck([...remainingDeck, ...selected]);
    }
    
    setSelected([]);
    setDiscardsLeft(discardsLeft - 1);
    setStreakCount(0); // זריקה מאפסת את הרצף
  };

  const generateShop = () => {
    const availableJokers = JOKERS.filter(j => !jokers.find(oj => oj.id === j.id));
    const shopJ = shuffleArray(availableJokers).slice(0, 3);
    setShopJokers(shopJ);
    
    const shopU = shuffleArray(UPGRADES).slice(0, 3);
    setShopUpgrades(shopU);
    
    // Vouchers - רק אלה שעוד לא קנינו ושעומדים בדרישות
    const availableVouchers = VOUCHERS.filter(v => {
      const alreadyOwned = vouchers.includes(v.id);
      const meetsRequirements = !v.requires || vouchers.includes(v.requires);
      return !alreadyOwned && meetsRequirements;
    });
    const shopV = shuffleArray(availableVouchers).slice(0, 2);
    setShopVouchers(shopV);
    
    // 🎴 קלפים לקנייה
    const shopCards = [];
    // 2 קלפים רגילים (1₪)
    for (let i = 0; i < 2; i++) {
      const randomLetter = shuffleArray('אבגדהוזחטיכלמנסעפצקרשת'.split(''))[0];
      const color = LETTER_COLORS[randomLetter];
      shopCards.push({
        letter: randomLetter,
        value: LETTER_VALUES[randomLetter],
        color,
        id: Math.random(),
        upgrades: [],
        cost: 1,
        type: 'normal'
      });
    }
    // 1 קלף בונוס (Wildcard או משודרג) - 3-5₪
    const bonusType = Math.random();
    if (bonusType < 0.5) {
      // Wildcard
      shopCards.push({
        letter: '*',
        value: 0,
        color: 'rainbow',
        id: Math.random(),
        upgrades: [],
        isWildcard: true,
        cost: 4,
        type: 'wildcard'
      });
    } else {
      // קלף משודרג
      const randomLetter = shuffleArray('שתרק'.split(''))[0]; // אותיות חזקות
      const color = LETTER_COLORS[randomLetter];
      const randomUpgrade = shuffleArray(UPGRADES)[0];
      shopCards.push({
        letter: randomLetter,
        value: LETTER_VALUES[randomLetter],
        color,
        id: Math.random(),
        upgrades: [randomUpgrade.id],
        cost: 5,
        type: 'upgraded'
      });
    }
    setShopCards(shopCards);
  };

  const buyCard = (card) => {
    if (money >= card.cost) {
      // הוסף את הקלף לחפיסה
      const newCard = { ...card };
      delete newCard.cost;
      delete newCard.type;
      setDeck([...deck, newCard]);
      setMoney(money - card.cost);
      setShopCards(shopCards.filter(c => c.id !== card.id));
    }
  };

  const sellJoker = (joker) => {
    const sellPrice = Math.floor(joker.cost / 2);
    setJokers(jokers.filter(j => j.id !== joker.id));
    setMoney(money + sellPrice);
  };

  const buyVoucher = (voucher) => {
    if (money >= voucher.cost) {
      setVouchers([...vouchers, voucher.id]);
      setMoney(money - voucher.cost);
      setShopVouchers(shopVouchers.filter(v => v.id !== voucher.id));
      
      // החל השפעות מיידיות
      if (voucher.type === 'joker_slot') {
        setMaxJokers(maxJokers + 1);
      }
      if (voucher.type === 'hand_size') {
        setHandSize(handSize + 2);
      }
      if (voucher.type === 'extra_hands') {
        setBaseHands(baseHands + 1);
      }
      if (voucher.type === 'extra_discards') {
        setBaseDiscards(baseDiscards + 1);
      }
      if (voucher.type === 'discount') {
        setHasDiscount(true);
      }
      if (voucher.type === 'free_reroll') {
        setHasFreeReroll(true);
      }
    }
  };

  const buyJoker = (joker) => {
    if (money >= joker.cost && jokers.length < maxJokers) {
      setJokers([...jokers, joker]);
      setMoney(money - joker.cost);
      setShopJokers(shopJokers.filter(j => j.id !== joker.id));
    }
  };

  const buyUpgrade = (upgrade) => {
    if (money >= upgrade.cost) {
      setSelectedUpgrade(upgrade);
      setGameMode('upgrade');
    }
  };

  const applyUpgrade = (card) => {
    if (!selectedUpgrade || card.upgrades?.includes(selectedUpgrade.id)) return;
    
    const allCards = [...hand, ...deck];
    const updatedCards = allCards.map(c => {
      if (c.id === card.id) {
        return { ...c, upgrades: [...(c.upgrades || []), selectedUpgrade.id] };
      }
      return c;
    });
    
    setHand(updatedCards.slice(0, hand.length));
    setDeck(updatedCards.slice(hand.length));
    setMoney(money - selectedUpgrade.cost);
    setSelectedUpgrade(null);
    setGameMode('shop');
  };

  const continueGame = () => {
    let newBlind = blind;
    let newAnte = ante;
    
    if (blind === 'small') {
      newBlind = 'big';
    } else if (blind === 'big') {
      newBlind = 'boss';
    } else {
      newAnte = ante + 1;
      newBlind = 'small';
    }
    
    setBlind(newBlind);
    setAnte(newAnte);
    
    // עבור לבחירת blind
    setGameMode('blindSelect');
  };

  const startBlind = () => {
    const config = BLIND_CONFIGS[blind];
    const diffConfig = DIFFICULTIES[difficulty];
    // ניקוד עולה בכפול 2 בכל Ante — עלייה תלולה!
    // Ante 1: 300, Ante 2: 600, Ante 3: 1200, Ante 4: 2400, Ante 5: 4800...
    const baseScore = 300 * Math.pow(2, ante - 1);
    const newTargetScore = Math.floor(baseScore * config.scoreMultiplier * diffConfig.scoreMultiplier);
    setTargetScore(newTargetScore);
    
    // איפוס מוני ג'וקרים בין שלבים
    setJokerCounters({});
    setStreakCount(0);
    setLetterUsedInBlind({});
    
    // הגדר אתגר בוס - מהרשימה המעורבבת!
    if (blind === 'boss') {
      const bossIndex = Math.min(ante - 1, shuffledBosses.length - 1);
      const bossBlind = shuffledBosses[bossIndex] || shuffledBosses[0];
      setCurrentBossBlind(bossBlind);
      
      // אתגרים מיוחדים
      if (bossBlind.id === 'no_discards') {
        setDiscardsLeft(0);
        setHandsLeft(config.hands);
      } else if (bossBlind.id === 'few_hands' || bossBlind.id === 'time_limit') {
        setHandsLeft(2);
        setDiscardsLeft(config.discards);
      } else {
        setHandsLeft(config.hands);
        setDiscardsLeft(config.discards);
      }
    } else {
      setCurrentBossBlind(null);
      setHandsLeft(config.hands);
      setDiscardsLeft(config.discards);
    }
    
    setScore(0);
    setMegaComboMult(1); // איפוס מגה קומבו בכל שלב חדש
    setWildcardChosenLetter({}); // איפוס בחירות Wildcard
    // אחרת - שמור את החפיסה הקיימת עם השדרוגים!
    if (deck.length === 0 && hand.length === 0) {
      const newDeck = createDeck();
      setDeck(newDeck.slice(handSize));
      setHand(newDeck.slice(0, handSize));
    } else {
      // ערבב את כל הקלפים (יד + חפיסה) ותן יד חדשה
      const allCards = shuffleArray([...hand, ...deck]);
      setDeck(allCards.slice(handSize));
      setHand(allCards.slice(0, handSize));
    }
    
    setSelected([]);
    setGameMode('game');
  };

  // ===============================
  // מסכים
  // ===============================

  // 🎬 מסך פתיחה למשחק חדש - הוראות קצרות + הצגת החפיסה
  if (gameMode === 'gameIntro') {
    const allCards = deck;
    const colorCounts = { red: 0, blue: 0, yellow: 0, green: 0, rainbow: 0 };
    allCards.forEach(c => { if (colorCounts[c.color] !== undefined) colorCounts[c.color]++; });
    
    return (
      <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
        <div className="max-w-2xl w-full">
          <div className="text-center mb-6">
            <div className="text-6xl mb-3">🎴</div>
            <h1 className="text-4xl font-bold text-yellow-400 mb-2">מוכנים לשחק!</h1>
            <p className="text-gray-300">הנה תקציר מהיר:</p>
          </div>
          
          <div className="bg-black/40 backdrop-blur-sm p-5 rounded-2xl mb-4 space-y-3 text-sm">
            <div className="flex items-start gap-2"><span className="text-xl">🃏</span><span>בחר 2-5 אותיות מהיד שלך וצור מילה בעברית</span></div>
            <div className="flex items-start gap-2"><span className="text-xl">🎯</span><span>הגע ליעד הנקודות לפני שהידיים נגמרות</span></div>
            <div className="flex items-start gap-2"><span className="text-xl">🔄</span><span>זרוק קלפים שלא מתאימים לך כדי לקבל חדשים</span></div>
            <div className="flex items-start gap-2"><span className="text-xl">🏪</span><span>בסוף כל שלב — חנות! קנה ג׳וקרים ושדרוגים</span></div>
            <div className="flex items-start gap-2"><span className="text-xl">📏</span><span>מילים ארוכות = יותר נקודות ומכפילים גבוהים</span></div>
          </div>

          <div className="bg-black/30 p-4 rounded-xl mb-4">
            <h3 className="font-bold text-blue-300 mb-3 text-center">🎴 האותיות שהוגרלו לך ({allCards.length} קלפים)</h3>
            <div className="flex justify-center gap-3 flex-wrap mb-3">
              {Object.entries(COLOR_STYLES).map(([color, style]) => {
                const count = colorCounts[color] || 0;
                if (count === 0) return null;
                return (
                  <div key={color} className={"px-3 py-1 rounded-full bg-gradient-to-r " + style.gradient + " " + style.text + " text-sm font-bold"}>
                    {style.icon} {count}
                  </div>
                );
              })}
            </div>
            <div className="flex flex-wrap gap-1 justify-center">
              {allCards.sort((a, b) => (LETTER_VALUES[a.letter] || 0) - (LETTER_VALUES[b.letter] || 0)).map((card, i) => (
                <div key={i} className={"w-8 h-10 rounded border flex items-center justify-center text-sm font-bold bg-gradient-to-br " + (COLOR_STYLES[card.color] || COLOR_STYLES.rainbow).gradient + " " + (COLOR_STYLES[card.color] || COLOR_STYLES.rainbow).text}>
                  {card.letter}
                </div>
              ))}
            </div>
          </div>

          <button
            onClick={() => setGameMode('blindSelect')}
            className="w-full px-8 py-5 bg-gradient-to-r from-green-600 to-green-800 rounded-xl font-bold text-2xl hover:from-green-700 hover:to-green-900 transition-all transform hover:scale-105 shadow-xl"
          >
            🚀 יאללה!
          </button>
        </div>
      </div>
    );
  }

  // 🎉 מסך ניצחון שלב
  if (gameMode === 'stageWin') {
    return (
      <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 relative overflow-hidden">
        <Confetti />
        <div className="text-center relative z-10">
          <div className="text-8xl mb-4 animate-bounce">🎉</div>
          <h1 className="text-5xl font-bold text-yellow-400 mb-3" style={{textShadow: '0 0 30px rgba(250,204,21,0.5)'}}>כל הכבוד!</h1>
          <div className="text-2xl text-green-400 font-bold mb-2">הגעת ל-{score.toLocaleString()} נקודות!</div>
          <div className="text-lg text-gray-300 mb-6">היעד היה {targetScore.toLocaleString()} — עברת אותו! 🌟</div>
          
          <div className="flex justify-center gap-3 mb-6">
            {['⭐','🌟','✨','💫','🎊'].map((emoji, i) => (
              <span key={i} className="text-3xl" style={{animation: 'bounce 1s ease-in-out infinite', animationDelay: i * 0.15 + 's'}}>{emoji}</span>
            ))}
          </div>
          
          <button
            onClick={() => {
              setRerollUsedThisShop(false);
              generateShop();
              setGameMode('shop');
            }}
            className="px-12 py-5 bg-gradient-to-r from-yellow-500 to-orange-600 rounded-xl font-bold text-2xl hover:from-yellow-600 hover:to-orange-700 transition-all transform hover:scale-110 shadow-2xl text-black"
          >
            🏪 לחנות!
          </button>
        </div>
        <style>{
          "@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}"
        }</style>
      </div>
    );
  }

  // 😢 מסך הפסד שלב
  if (gameMode === 'stageLoss') {
    return (
      <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-red-900/30 to-slate-900 relative overflow-hidden">
        <div className="text-center relative z-10">
          <div className="text-7xl mb-4" style={{animation: 'shake 0.5s ease-in-out'}}>😮</div>
          <h1 className="text-4xl font-bold text-blue-300 mb-3">לא נורא!</h1>
          <div className="text-xl text-gray-300 mb-2">הגעת ל-{score.toLocaleString()} מתוך {targetScore.toLocaleString()} נקודות</div>
          <div className="text-lg text-yellow-300 mb-6">בפעם הבאה בטוח תצליח! 💪</div>
          
          <div className="flex justify-center gap-2 mb-6">
            {['💪','🔥','⚡'].map((emoji, i) => (
              <span key={i} className="text-3xl" style={{animation: 'pulse 1.5s ease-in-out infinite', animationDelay: i * 0.3 + 's'}}>{emoji}</span>
            ))}
          </div>
          
          <div className="space-y-3">
            <button
              onClick={() => {
                startGame(kidsMode, difficulty);
              }}
              className="w-64 px-8 py-4 bg-gradient-to-r from-green-600 to-green-800 rounded-xl font-bold text-xl hover:from-green-700 hover:to-green-900 transition-all transform hover:scale-105 shadow-xl"
            >
              🔄 בוא ננסה שוב!
            </button>
            <br/>
            <button
              onClick={() => setGameMode('menu')}
              className="w-64 px-6 py-3 bg-gray-700 rounded-xl font-bold hover:bg-gray-600 transition-all"
            >
              🏠 תפריט ראשי
            </button>
          </div>
        </div>
        <style>{
          "@keyframes shake{0%,100%{transform:rotate(0)}25%{transform:rotate(-5deg)}75%{transform:rotate(5deg)}}@keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.7;transform:scale(1.2)}}"
        }</style>
      </div>
    );
  }

  if (gameMode === 'blindSelect') {
    const config = BLIND_CONFIGS[blind];
    const baseScore = 300 * Math.pow(2, ante - 1);
    const newTargetScore = Math.floor(baseScore * config.scoreMultiplier);
    // חשוב: השתמש בבוס מהרשימה המעורבבת כדי שהתיאור יתאים למה שיקרה בפועל!
    const bossBlind = blind === 'boss' ? (shuffledBosses[Math.min(ante - 1, shuffledBosses.length - 1)] || shuffledBosses[0]) : null;
    // הבוס הבא (לתצוגה מוקדמת)
    const nextBossIndex = Math.min(ante - 1, shuffledBosses.length - 1);
    const nextBoss = shuffledBosses[nextBossIndex] || shuffledBosses[0];
    
    return (
      <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
        <div className="max-w-2xl w-full bg-black/50 backdrop-blur-sm p-8 rounded-2xl shadow-2xl border-4 border-white/20">
          <div className="text-center mb-6">
            <h1 className="text-5xl font-bold mb-2 text-yellow-400">
              {config.icon} {config.name}
            </h1>
            <div className="text-2xl text-gray-300">
              Ante {ante}
            </div>
          </div>

          <div className="space-y-4 mb-6">
            <div className="bg-blue-900/50 p-4 rounded-xl border-2 border-blue-500">
              <div className="text-lg font-bold mb-1 text-blue-300">🎯 דרישות:</div>
              <div className="text-3xl font-bold text-white">
                {newTargetScore.toLocaleString()} נקודות
              </div>
            </div>

            <div className="grid grid-cols-3 gap-3">
              <div className="bg-green-900/50 p-3 rounded-xl border border-green-500 text-center">
                <div className="text-2xl font-bold">{bossBlind?.id === 'few_hands' ? 2 : config.hands}</div>
                <div className="text-xs text-green-300">🃏 ידיים</div>
              </div>
              <div className="bg-orange-900/50 p-3 rounded-xl border border-orange-500 text-center">
                <div className="text-2xl font-bold">{bossBlind?.id === 'no_discards' ? 0 : config.discards}</div>
                <div className="text-xs text-orange-300">🔄 זריקות</div>
              </div>
              <div className="bg-yellow-900/50 p-3 rounded-xl border border-yellow-500 text-center">
                <div className="text-2xl font-bold">{config.reward}₪</div>
                <div className="text-xs text-yellow-300">💰 פרס</div>
              </div>
            </div>

            {/* אתגר בוס נוכחי */}
            {bossBlind && (
              <div className="bg-red-900/50 p-4 rounded-xl border-2 border-red-500 animate-pulse">
                <div className="text-lg font-bold mb-1 text-red-300">
                  {bossBlind.icon} אתגר בוס: {bossBlind.name}
                </div>
                <div className="text-sm text-white">
                  {bossBlind.desc}
                </div>
              </div>
            )}

            {/* אזהרת בוס הבא - בכל שלב */}
            {blind !== 'boss' && nextBoss && (
              <div className="bg-red-900/20 p-3 rounded-xl border border-red-800/50">
                <div className="flex items-center gap-2 text-sm">
                  <span className="text-red-400">⚠️</span>
                  <span className="text-red-300 font-bold">הבוס הבא: {nextBoss.icon} {nextBoss.name}</span>
                </div>
                <div className="text-xs text-red-200/70 mt-1 mr-6">{nextBoss.desc}</div>
              </div>
            )}
          </div>

          <button
            onClick={startBlind}
            className="w-full px-8 py-5 bg-gradient-to-r from-green-600 to-green-800 rounded-xl font-bold text-2xl hover:from-green-700 hover:to-green-900 transition-all transform hover:scale-105 shadow-xl"
          >
            ▶️ התחל!
          </button>
        </div>
      </div>
    );
  }

  // ===============================
  // מסך בחירת רמת קושי
  // ===============================
  
  if (gameMode === 'difficulty' || gameMode === 'difficulty_kids') {
    const isKids = gameMode === 'difficulty_kids';
    
    return (
      <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
        <div className="max-w-4xl w-full">
          <button
            onClick={() => setGameMode('menu')}
            className="mb-6 px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition"
          >
            ← חזור לתפריט
          </button>

          <div className="text-center mb-8">
            <h1 className="text-4xl font-bold text-yellow-400 mb-2">
              {isKids ? '👶 מצב ילדים' : '🎮 משחק חופשי'}
            </h1>
            <p className="text-xl text-gray-300">בחר רמת קושי</p>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {Object.entries(DIFFICULTIES).map(([key, diff]) => (
              <button
                key={key}
                onClick={() => startGame(isKids, key)}
                className={`p-6 bg-gradient-to-r ${diff.color} rounded-xl hover:scale-105 transition-all transform shadow-xl`}
              >
                <div className="text-5xl mb-3">{diff.icon}</div>
                <div className="text-2xl font-bold mb-2">{diff.name}</div>
                <div className="text-sm mb-3">{diff.desc}</div>
                <div className="text-xs space-y-1 bg-black/30 p-3 rounded-lg">
                  <div>💰 כסף התחלה: {diff.startMoney}₪</div>
                  <div>🎯 יעד: ×{diff.scoreMultiplier}</div>
                </div>
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  // ===============================
  // מסך הוראות
  // ===============================
  
  if (gameMode === 'help') {
    return (
      <div className="min-h-screen p-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
        <div className="max-w-4xl mx-auto">
          <button
            onClick={() => setGameMode('menu')}
            className="mb-4 px-6 py-3 bg-gray-700 rounded-lg hover:bg-gray-600 transition"
          >
            ← חזור לתפריט
          </button>

          <div className="bg-black/40 backdrop-blur-sm p-8 rounded-2xl">
            <h1 className="text-4xl font-bold mb-6 text-yellow-400 text-center">
              📖 איך לשחק ב"כתב"
            </h1>

            {/* מטרת המשחק */}
            <div className="mb-6">
              <h2 className="text-2xl font-bold mb-3 text-blue-300">🎯 מטרת המשחק</h2>
              <p className="text-lg">
                בנה מילים מאותיות עבריות כדי לצבור נקודות והגע ליעד!
              </p>
            </div>

            {/* איך זה עובד */}
            <div className="mb-6">
              <h2 className="text-2xl font-bold mb-3 text-green-300">🎮 איך זה עובד?</h2>
              <div className="space-y-2 text-lg">
                <div>1️⃣ בחר 2-5 אותיות מהיד שלך</div>
                <div>2️⃣ לחץ "שחק מילה" כדי לקבל נקודות</div>
                <div>3️⃣ הגע ליעד לפני שהידיים נגמרות</div>
                <div>4️⃣ קנה ג׳וקרים בחנות לאחר כל Blind</div>
              </div>
            </div>

            {/* מערכת הניקוד */}
            <div className="mb-6">
              <h2 className="text-2xl font-bold mb-3 text-purple-300">📊 מערכת הניקוד</h2>
              <div className="bg-purple-900/30 p-4 rounded-lg space-y-2">
                <div>💎 <strong>ערך אותיות:</strong> א=1, ב=2, ... ת=22</div>
                <div>⭐ <strong>בונוס לפי אורך:</strong></div>
                <div className="mr-6 space-y-1 text-sm">
                  <div>• 2 אותיות: +10 צ׳יפס × 1</div>
                  <div>• 3 אותיות: +20 צ׳יפס × 2</div>
                  <div>• 4 אותיות: +40 צ׳יפס × 4</div>
                  <div>• 5 אותיות: +60 צ׳יפס × 5</div>
                </div>
                <div className="mt-3 p-3 bg-yellow-900/40 rounded-lg text-sm">
                  <strong>נוסחה:</strong> (סכום אותיות + בונוס) × מכפיל
                </div>
              </div>
            </div>

            {/* דוגמה */}
            <div className="mb-6">
              <h2 className="text-2xl font-bold mb-3 text-yellow-300">💡 דוגמה</h2>
              <div className="bg-yellow-900/30 p-4 rounded-lg text-sm">
                <div className="text-lg mb-2">מילה: "שלום" (5 אותיות)</div>
                <div>ש(21) + ל(12) + ו(6) + ם(13) = 52</div>
                <div>בונוס: +60 צ׳יפס</div>
                <div>סה"כ: 112 צ׳יפס</div>
                <div>מכפיל: ×5</div>
                <div className="text-xl font-bold text-yellow-400 mt-2">
                  ניקוד: 112 × 5 = 560 נקודות! 🎉
                </div>
              </div>
            </div>

            {/* טיפים */}
            <div>
              <h2 className="text-2xl font-bold mb-3 text-orange-300">💡 טיפים</h2>
              <div className="space-y-2">
                <div>🎴 קנה ג׳וקרים שמשלימים אחד את השני</div>
                <div>⬆️ שדרג אותיות חזקות (כמו ש, ת, ר)</div>
                <div>🎯 שמור ידיים לסוף - תקבל כסף בונוס!</div>
                <div>📏 מילים ארוכות = יותר נקודות</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  // ===============================
  // מסך תפריט ראשי
  // ===============================
  
  if (gameMode === 'menu') {
    return (
      <div className="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
        <div className="text-center">
          <h1 className="text-7xl font-bold mb-6 text-yellow-400 animate-pulse">🎴 כתב 🎴</h1>
          <p className="text-2xl mb-2 text-blue-300">משחק קלפי האותיות</p>
          <p className="text-sm mb-8 text-gray-400">מבוסס על Balatro</p>
          
          <div className="space-y-4">
            <button
              onClick={() => setGameMode('difficulty')}
              className="w-72 px-8 py-5 bg-gradient-to-r from-blue-600 to-blue-800 rounded-xl font-bold text-xl hover:from-blue-700 hover:to-blue-900 transition-all transform hover:scale-105 shadow-xl hover:shadow-blue-500/50"
            >
              🎮 משחק חופשי
            </button>
            
            <button
              onClick={() => setGameMode('difficulty_kids')}
              className="w-72 px-8 py-5 bg-gradient-to-r from-green-600 to-green-800 rounded-xl font-bold text-xl hover:from-green-700 hover:to-green-900 transition-all transform hover:scale-105 shadow-xl hover:shadow-green-500/50"
            >
              👶 מצב ילדים
            </button>
            
            <button
              onClick={() => setGameMode('help')}
              className="w-72 px-8 py-4 bg-gradient-to-r from-purple-600 to-purple-800 rounded-xl font-bold text-lg hover:from-purple-700 hover:to-purple-900 transition-all transform hover:scale-105 shadow-xl hover:shadow-purple-500/50"
            >
              📖 הוראות והסבר
            </button>
            
            <div className="text-sm text-gray-400 mt-6 max-w-md mx-auto bg-black/30 p-4 rounded-lg">
              <p className="mb-3"><strong className="text-blue-400">🎮 משחק חופשי:</strong><br/>כל מילה מתקבלת אוטומטית</p>
              <p><strong className="text-green-400">👶 מצב ילדים:</strong><br/>מבוגר צריך לאשר שהמילה נכונה</p>
            </div>
          </div>
        </div>
      </div>
    );
  }

  if (gameMode === 'shop') {
    return (
      <div className="min-h-screen p-3 md:p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex flex-col" style={{maxHeight: '100vh', overflow: 'hidden'}}>
        {/* Purchase confirmation modal */}
        {confirmPurchase && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={() => setConfirmPurchase(null)}>
            <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl border-2 border-yellow-400 max-w-sm w-full" onClick={e => e.stopPropagation()}>
              <div className="text-center mb-4">
                <div className="text-4xl mb-2">{confirmPurchase.item.icon}</div>
                <div className="text-xl font-bold text-yellow-400">{confirmPurchase.item.name}</div>
                <div className="text-sm text-gray-300 mt-1">{confirmPurchase.item.desc}</div>
                <div className="text-2xl font-bold text-yellow-300 mt-3">{confirmPurchase.item.cost}₪</div>
              </div>
              <div className="flex gap-3">
                <button onClick={() => {
                  if (confirmPurchase.type === 'joker') buyJoker(confirmPurchase.item);
                  else if (confirmPurchase.type === 'voucher') buyVoucher(confirmPurchase.item);
                  else if (confirmPurchase.type === 'upgrade') buyUpgrade(confirmPurchase.item);
                  else if (confirmPurchase.type === 'card') buyCard(confirmPurchase.item);
                  setConfirmPurchase(null);
                }} className="flex-1 py-3 bg-gradient-to-r from-green-600 to-green-800 rounded-xl font-bold text-lg hover:from-green-700 hover:to-green-900 transition-all">✓ קנה!</button>
                <button onClick={() => setConfirmPurchase(null)} className="flex-1 py-3 bg-gray-700 rounded-xl font-bold text-lg hover:bg-gray-600 transition-all">✗ ביטול</button>
              </div>
            </div>
          </div>
        )}

        {/* Joker detail modal (mobile) */}
        {jokerDetail && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={() => setJokerDetail(null)}>
            <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl border-2 border-purple-400 max-w-sm w-full" onClick={e => e.stopPropagation()}>
              <div className="text-center">
                <div className="text-5xl mb-3">{jokerDetail.icon}</div>
                <div className="text-xl font-bold text-yellow-400 mb-2">{jokerDetail.name}</div>
                <div className="text-sm text-gray-300 mb-3">{jokerDetail.desc}</div>
                <div className="text-xs text-purple-300 mb-4">נדירות: {jokerDetail.rarity}</div>
                <button onClick={() => setJokerDetail(null)} className="px-6 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">סגור</button>
              </div>
            </div>
          </div>
        )}

        {/* Deck viewer modal */}
        {showShopDeck && (
          <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={() => setShowShopDeck(false)}>
            <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-4 rounded-2xl border-2 border-blue-400 max-w-lg w-full max-h-[80vh] overflow-y-auto" onClick={e => e.stopPropagation()}>
              <h3 className="text-xl font-bold text-blue-300 mb-3 text-center">🎴 החפיסה שלך ({[...hand, ...deck].length} קלפים)</h3>
              <div className="flex flex-wrap gap-1 justify-center mb-3">
                {[...hand, ...deck].sort((a, b) => (LETTER_VALUES[a.letter] || 0) - (LETTER_VALUES[b.letter] || 0)).map((card, i) => (
                  <div key={i} className={"w-9 h-11 rounded border flex items-center justify-center text-sm font-bold bg-gradient-to-br " + (COLOR_STYLES[card.color] || COLOR_STYLES.rainbow).gradient + " " + (COLOR_STYLES[card.color] || COLOR_STYLES.rainbow).text}>
                    {card.letter}
                  </div>
                ))}
              </div>
              <button onClick={() => setShowShopDeck(false)} className="w-full py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition font-bold">סגור</button>
            </div>
          </div>
        )}

        {/* Header */}
        <div className="flex justify-between items-center mb-2 bg-black/30 p-2 rounded-xl">
          <h1 className="text-2xl md:text-3xl font-bold text-yellow-400">🏪 החנות</h1>
          <div className="flex items-center gap-3">
            <button onClick={() => setShowShopDeck(true)} className="px-3 py-1 bg-blue-800 rounded-lg text-sm hover:bg-blue-700 transition">🎴 חפיסה</button>
            <div className="text-2xl font-bold text-yellow-400">💰 {money}₪</div>
          </div>
        </div>

        {/* My jokers */}
        {jokers.length > 0 && (
          <div className="mb-2 bg-black/20 p-2 rounded-xl">
            <div className="text-xs font-bold text-green-300 mb-1">הג'וקרים שלי ({jokers.length}/{maxJokers})</div>
            <div className="flex gap-1 flex-wrap">
              {jokers.map((joker) => (
                <div key={joker.id} className="relative group">
                  <div onClick={() => setJokerDetail(joker)} className="w-10 h-10 bg-gradient-to-br from-green-700 to-green-900 rounded-lg flex items-center justify-center text-lg cursor-pointer hover:scale-110 transition border border-green-500">
                    {joker.icon}
                  </div>
                  <div className="hidden md:block absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-48 bg-black/95 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-30 text-xs">
                    <div className="font-bold text-yellow-400">{joker.icon} {joker.name}</div>
                    <div className="text-gray-300">{joker.desc}</div>
                    <button onClick={(e) => { e.stopPropagation(); sellJoker(joker); }} className="mt-1 w-full py-1 bg-red-700 rounded text-xs hover:bg-red-600">מכור ({Math.floor(joker.cost / 2)}₪)</button>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* Main shop grid */}
        <div className="flex-1 grid grid-cols-1 md:grid-cols-2 gap-2 overflow-hidden min-h-0">
          {/* Jokers for sale */}
          <div className="bg-black/20 p-2 rounded-xl overflow-hidden flex flex-col">
            <div className="text-xs font-bold text-blue-300 mb-1">🃏 ג'וקרים ({jokers.length}/{maxJokers})</div>
            <div className="flex gap-2 flex-wrap flex-1 content-start">
              {shopJokers.length > 0 ? shopJokers.map(joker => (
                <div key={joker.id} className="relative group flex-shrink-0">
                  <div
                    onClick={() => {
                      if (money >= joker.cost && jokers.length < maxJokers) {
                        setConfirmPurchase({ type: 'joker', item: joker });
                      }
                    }}
                    className={"w-20 h-24 bg-gradient-to-br rounded-lg border-2 flex flex-col items-center justify-center p-1 transition-all cursor-pointer " + 
                      (joker.rarity === 'legendary' ? 'from-purple-600 to-purple-900 border-purple-400' : joker.rarity === 'rare' ? 'from-blue-600 to-blue-800 border-blue-400' : joker.rarity === 'uncommon' ? 'from-green-600 to-green-800 border-green-400' : 'from-gray-600 to-gray-800 border-gray-400') +
                      (money >= joker.cost && jokers.length < maxJokers ? ' hover:scale-105 hover:shadow-lg' : ' opacity-50')}
                  >
                    <div className="text-2xl">{joker.icon}</div>
                    <div className="text-[9px] font-bold text-center leading-tight mt-0.5">{joker.name}</div>
                    <div className="text-xs font-bold text-yellow-400 mt-auto">{joker.cost}₪</div>
                  </div>
                  <div className="hidden md:block absolute bottom-full left-1/2 -translate-x-1/2 mb-1 w-48 bg-black/95 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-30 text-xs">
                    <div className="font-bold text-yellow-400">{joker.icon} {joker.name}</div>
                    <div className="text-gray-300">{joker.desc}</div>
                    <div className="text-purple-300 mt-1">{joker.rarity}</div>
                  </div>
                </div>
              )) : <div className="text-gray-500 text-xs">אין ג'וקרים זמינים</div>}
            </div>
          </div>

          {/* Right column: Vouchers + Upgrades + Cards */}
          <div className="flex flex-col gap-2 overflow-hidden">
            {/* Vouchers */}
            {shopVouchers.length > 0 && (
              <div className="bg-black/20 p-2 rounded-xl">
                <div className="text-xs font-bold text-orange-300 mb-1">🎁 בונוסים</div>
                <div className="flex gap-2 flex-wrap">
                  {shopVouchers.map(voucher => (
                    <div key={voucher.id} onClick={() => money >= voucher.cost ? setConfirmPurchase({ type: 'voucher', item: voucher }) : null}
                      className={"flex-1 min-w-[120px] p-2 bg-gradient-to-br from-orange-600 to-orange-800 rounded-lg border border-orange-400 transition-all text-center cursor-pointer " + (money >= voucher.cost ? 'hover:scale-105' : 'opacity-50')}>
                      <div className="text-xl">{voucher.icon}</div>
                      <div className="text-[10px] font-bold">{voucher.name}</div>
                      <div className="text-[9px] text-white/80">{voucher.desc}</div>
                      <div className="text-sm font-bold text-yellow-300">{voucher.cost}₪</div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Upgrades */}
            <div className="bg-black/20 p-2 rounded-xl">
              <div className="text-xs font-bold text-purple-300 mb-1">✨ שדרוגים</div>
              <div className="flex gap-2 flex-wrap">
                {shopUpgrades.map(upgrade => (
                  <div key={upgrade.id} onClick={() => money >= upgrade.cost ? setConfirmPurchase({ type: 'upgrade', item: upgrade }) : null}
                    className={"flex-1 min-w-[80px] p-2 bg-gradient-to-br from-purple-600 to-purple-800 rounded-lg border border-purple-400 text-center transition-all cursor-pointer " + (money >= upgrade.cost ? 'hover:scale-105' : 'opacity-50')}>
                    <div className="text-xl">{upgrade.icon}</div>
                    <div className="text-[10px] font-bold">{upgrade.name}</div>
                    <div className="text-sm font-bold text-yellow-300">{upgrade.cost}₪</div>
                  </div>
                ))}
              </div>
            </div>

            {/* Cards for sale */}
            {shopCards.length > 0 && (
              <div className="bg-black/20 p-2 rounded-xl">
                <div className="text-xs font-bold text-cyan-300 mb-1">🎴 קלפים</div>
                <div className="flex gap-2 flex-wrap">
                  {shopCards.map(card => (
                    <div key={card.id} onClick={() => money >= card.cost ? setConfirmPurchase({ type: 'card', item: card }) : null}
                      className={"flex-1 min-w-[70px] p-2 bg-gradient-to-br from-cyan-700 to-cyan-900 rounded-lg border border-cyan-500 text-center transition-all cursor-pointer " + (money >= card.cost ? 'hover:scale-105' : 'opacity-50')}>
                      <div className={"text-2xl font-bold " + (COLOR_STYLES[card.color] || {}).text}>{card.letter}</div>
                      <div className="text-[9px] text-cyan-200">{card.type === 'wildcard' ? '🌈 כוכב' : card.type === 'upgraded' ? '✨ משודרג' : 'רגיל'}</div>
                      <div className="text-sm font-bold text-yellow-300">{card.cost}₪</div>
                    </div>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Bottom buttons */}
        <div className="flex gap-2 mt-2">
          <button
            onClick={() => {
              const canRerollFree = hasFreeReroll && !rerollUsedThisShop;
              const rerollCost = canRerollFree ? 0 : 5;
              if (money >= rerollCost) {
                setMoney(money - rerollCost);
                if (canRerollFree) setRerollUsedThisShop(true);
                generateShop();
              }
            }}
            className={"flex-1 px-4 py-3 rounded-xl font-bold text-lg transition-all " + (money >= (hasFreeReroll && !rerollUsedThisShop ? 0 : 5) ? 'bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900' : 'bg-gray-600 opacity-50 cursor-not-allowed')}
            disabled={money < (hasFreeReroll && !rerollUsedThisShop ? 0 : 5)}
          >
            🔄 רענן ({hasFreeReroll && !rerollUsedThisShop ? 'חינם!' : '5₪'})
          </button>
          <button
            onClick={continueGame}
            className="flex-1 px-4 py-3 bg-gradient-to-r from-green-600 to-green-800 rounded-xl font-bold text-lg hover:from-green-700 hover:to-green-900 transition-all"
          >
            ➡️ המשך
          </button>
        </div>
      </div>
    );
  }

  if (gameMode === 'upgrade') {
    return (
      <div className="min-h-screen p-6 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
        <div className="max-w-6xl mx-auto">
          <div className="bg-black/30 p-6 rounded-xl mb-6">
            <h1 className="text-3xl font-bold mb-2 text-yellow-400">
              בחר אות לשדרוג
            </h1>
            <div className="text-xl text-purple-300">
              {selectedUpgrade?.icon} {selectedUpgrade?.name} - {selectedUpgrade?.desc}
            </div>
          </div>
          
          <div className="flex flex-wrap gap-3 mb-6 justify-center">
            {[...hand, ...deck].map(card => (
              <div key={card.id} className="relative">
                <Card
                  card={card}
                  onClick={() => applyUpgrade(card)}
                  selected={false}
                  inHand={true}
                />
                {card.upgrades?.includes(selectedUpgrade?.id) && (
                  <div className="absolute inset-0 bg-red-500/50 rounded-lg flex items-center justify-center text-xs font-bold">
                    כבר יש
                  </div>
                )}
              </div>
            ))}
          </div>

          <button
            onClick={() => setGameMode('shop')}
            className="px-8 py-4 bg-gray-600 rounded-lg hover:bg-gray-700 font-bold text-xl transition"
          >
            ← חזור לחנות
          </button>
        </div>
      </div>
    );
  }

  // ===============================
  // מסך משחק ראשי
  // ===============================

  const selectedWord = selected.map(c => c.letter).join('');
  const selectedScore = selected.length >= 2 ? calculateScore(selected, jokers, currentBossBlind, megaComboMult) : 0;

  return (
    <div className="min-h-screen p-4 bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900">
      {showConfetti && <Confetti />}
      
      {/* מציג קלפים שנותרו */}
      {/* 🌟 בורר אות לWildcard */}
      {showWildcardPicker && (
        <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4">
          <div className="bg-gradient-to-br from-purple-900 to-indigo-900 p-6 rounded-2xl max-w-lg w-full border-4 border-yellow-400 shadow-2xl">
            <h2 className="text-2xl font-bold text-yellow-400 mb-1 text-center">🌟 קלף כוכב!</h2>
            <p className="text-center text-gray-300 mb-1 text-sm">בחר איזו אות ייצג הכוכב במילה זו</p>
            {selected.filter(c => c.isWildcard).length > 1 && (
              <p className="text-center text-yellow-300 mb-3 text-xs">
                (כוכב {Object.keys(wildcardChosenLetter).length + 1} מתוך {selected.filter(c => c.isWildcard).length})
              </p>
            )}
            <div className="grid grid-cols-6 gap-2 mb-4 max-h-64 overflow-y-auto">
              {'אבגדהוזחטיכלמנסעפצקרשתךםןףץ'.split('').map(letter => (
                <button
                  key={letter}
                  onClick={() => {
                    if (wildcardPicker) {
                      const newChoices = { ...wildcardChosenLetter, [wildcardPicker.cardId]: letter };
                      setWildcardChosenLetter(newChoices);
                      setWildcardPicker(null);
                      setShowWildcardPicker(false);
                      // בדוק אם יש עוד wildcards שצריכים בחירה
                      const remaining = selected.filter(c => c.isWildcard && !newChoices[c.id]);
                      if (remaining.length > 0) {
                        setTimeout(() => {
                          setWildcardPicker({ cardId: remaining[0].id });
                          setShowWildcardPicker(true);
                        }, 100);
                      } else {
                        // כל הwildcards נבחרו — שחק!
                        setTimeout(() => playHand(), 100);
                      }
                    } else {
                      setWildcardChoice(letter);
                      setShowWildcardPicker(false);
                      setTimeout(() => playHand(), 50);
                    }
                  }}
                  className="h-12 text-xl font-bold bg-white/10 hover:bg-yellow-500/40 border-2 border-white/20 hover:border-yellow-400 rounded-lg transition-all"
                >
                  {letter}
                </button>
              ))}
            </div>
            <button
              onClick={() => { setShowWildcardPicker(false); setWildcardPicker(null); }}
              className="w-full py-2 bg-gray-700 rounded-lg hover:bg-gray-600 text-sm"
            >
              ביטול
            </button>
          </div>
        </div>
      )}

      {showDeckViewer && (
        <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4"
             onClick={() => setShowDeckViewer(false)}>
          <div className="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl border-4 border-purple-500 max-w-6xl w-full max-h-[90vh] overflow-y-auto"
               onClick={(e) => e.stopPropagation()}>
            <div className="flex justify-between items-center mb-6">
              <h2 className="text-3xl font-bold text-purple-400">
                🎴 קלפים בחפיסה ({deck.length})
              </h2>
              <div className="text-sm text-purple-300">
                סה"כ קלפים במשחק: {deck.length + hand.length}
              </div>
              <button
                onClick={() => setShowDeckViewer(false)}
                className="text-4xl hover:text-red-400 transition"
              >
                ✕
              </button>
            </div>
            
            {/* סטטיסטיקות צבעים */}
            <div className="grid grid-cols-4 gap-4 mb-6">
              {['red', 'blue', 'yellow', 'green'].map(color => {
                const count = deck.filter(c => c.color === color).length;
                const colorStyle = COLOR_STYLES[color];
                return (
                  <div key={color} className={`bg-gradient-to-r ${colorStyle.gradient} p-4 rounded-lg border-2 ${colorStyle.border}`}>
                    <div className="text-2xl mb-1">{colorStyle.icon}</div>
                    <div className={`text-xl font-bold ${colorStyle.text}`}>{count} קלפים</div>
                    <div className={`text-sm ${colorStyle.text}`}>{colorStyle.name}</div>
                  </div>
                );
              })}
            </div>
            
            {/* כל הקלפים */}
            <div className="grid grid-cols-8 gap-2">
              {deck.map((card, i) => (
                <Card key={i} card={card} inHand={false} />
              ))}
            </div>
          </div>
        </div>
      )}
      
      <div className="max-w-7xl mx-auto">
        {/* סטטוס בר */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4 bg-black/40 backdrop-blur-sm p-3 md:p-5 rounded-xl shadow-2xl">
          {/* ניקוד */}
          <div>
            <div className="text-xs md:text-sm text-gray-400 mb-1">
              Ante {ante} - {blind === 'small' ? '🟢 קטן' : blind === 'big' ? '🟡 גדול' : '🔴 בוס'}
            </div>
            <div className="text-xl md:text-3xl font-bold mb-2">
              {score.toLocaleString()} / {targetScore.toLocaleString()}
            </div>
            <div className="w-full h-3 md:h-4 bg-gray-700 rounded-full overflow-hidden shadow-inner">
              <div
                className="h-full bg-gradient-to-r from-green-500 via-blue-500 to-purple-500 transition-all duration-500 shadow-lg"
                style={{ width: `${Math.min(100, (score / targetScore) * 100)}%` }}
              />
            </div>
          </div>
          
          {/* כסף וחפיסה */}
          <div className="text-center">
            <div className="text-yellow-400 text-2xl md:text-4xl font-bold drop-shadow-lg">💰 {money}₪</div>
            {kidsMode && (
              <div className="text-xs text-green-400 mt-1 bg-green-900/30 px-3 py-1 rounded-full inline-block">
                👶 מצב ילדים
              </div>
            )}
            
            {/* מונה קלפים + כפתור לצפייה */}
            <button
              onClick={() => setShowDeckViewer(!showDeckViewer)}
              className="mt-2 px-3 py-1.5 md:px-4 md:py-2 bg-gradient-to-r from-purple-600 to-purple-800 rounded-lg hover:from-purple-700 hover:to-purple-900 transition-all shadow-lg text-xs md:text-sm font-bold"
            >
              🎴 {deck.length} קלפים
            </button>
          </div>
          
          {/* ידיים וזריקות - בולטות במיוחד */}
          <div className="grid grid-cols-2 gap-2">
            <div className="bg-gradient-to-br from-blue-600 to-blue-800 p-3 rounded-lg text-center shadow-lg border-2 border-blue-400">
              <div className="text-3xl md:text-4xl font-bold text-white">{handsLeft}</div>
              <div className="text-xs md:text-sm text-blue-100">🃏 ידיים</div>
            </div>
            <div className="bg-gradient-to-br from-orange-600 to-orange-800 p-3 rounded-lg text-center shadow-lg border-2 border-orange-400">
              <div className="text-3xl md:text-4xl font-bold text-white">{discardsLeft}</div>
              <div className="text-xs md:text-sm text-orange-100">🔄 זריקות</div>
            </div>
          </div>
        </div>

        {/* ג'וקרים */}
        {jokers.length > 0 && (
          <div className="mb-4 flex gap-2 bg-black/30 backdrop-blur-sm p-3 rounded-xl overflow-x-auto shadow-lg flex-wrap">
            {jokers.map(joker => (
              <div key={joker.id} className="relative group">
                <JokerCard joker={joker} small />
                {/* מונה עבור ג'וקרים מצטברים */}
                {joker.id === 'mega_combo' && (
                  <div className="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-lg">
                    ×{megaComboMult}
                  </div>
                )}
                {joker.id === 'streak' && streakCount >= 3 && (
                  <div className="absolute -top-2 -right-2 bg-orange-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-lg">
                    🔥
                  </div>
                )}
                {joker.id === 'streak' && streakCount < 3 && (
                  <div className="absolute -top-2 -right-2 bg-gray-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center shadow-lg">
                    {streakCount}/3
                  </div>
                )}
              </div>
            ))}
          </div>
        )}

        {/* אתגר בוס */}
        {currentBossBlind && (
          <div className="mb-4 bg-red-900/30 backdrop-blur-sm p-4 rounded-xl border-2 border-red-500 animate-pulse">
            <div className="text-center">
              <span className="text-2xl mr-2">{currentBossBlind.icon}</span>
              <span className="font-bold text-red-300 text-lg">{currentBossBlind.name}:</span>
              <span className="text-white text-lg mr-2">{currentBossBlind.desc}</span>
            </div>
          </div>
        )}

        {/* יד הקלפים */}
        <div className="mb-6">
          {/* מציג את הבחירה הנוכחית של הwildcard */}
          {wildcardChoice && selected.some(c => c.isWildcard) && (
            <div className="text-center mb-2 text-yellow-300 text-sm font-bold">
              🌟 הכוכב ישמש כ: <span className="text-2xl">{wildcardChoice}</span>
              <button onClick={() => setWildcardChoice(null)} className="mr-2 text-xs text-gray-400 underline">שנה</button>
            </div>
          )}
          <div className="flex justify-center gap-3 flex-wrap mb-6 min-h-[140px]">
            {hand.map(card => (
              <Card
                key={card.id}
                card={card}
                onClick={() => toggleCard(card)}
                selected={!!selected.find(c => c.id === card.id)}
                inHand={!needsApproval}
              />
            ))}
          </div>

          {/* תצוגת מילה נבחרת */}
          {selected.length > 0 && (
            <div className="text-center mb-6 bg-black/40 backdrop-blur-sm p-6 rounded-xl shadow-2xl">
              <div className="text-5xl font-bold mb-3 tracking-wider text-yellow-300 drop-shadow-lg">
                {selectedWord}
              </div>
              {selected.length >= 2 && (
                <div>
                  <div className="text-3xl text-green-400 font-bold animate-pulse mb-3">
                    {selectedScore.toLocaleString()} נקודות
                  </div>
                  
                  {/* פירוט מהיר */}
                  <div className="text-sm space-y-1 bg-black/30 p-3 rounded-lg max-h-40 overflow-y-auto">
                    <div className="text-blue-300 font-bold">
                      💎 אותיות: {selected.reduce((sum, c) => sum + getCardValue(c), 0)}
                    </div>
                    <div className="text-green-300 font-bold">
                      ⭐ בונוס: +{({ 2: 10, 3: 20, 4: 40, 5: 60 })[selected.length] || 10}
                    </div>
                    <div className="text-purple-300 font-bold">
                      ✖️ מכפיל: ×{({ 2: 1, 3: 2, 4: 4, 5: 5 })[selected.length] || 1}
                    </div>
                    
                    {/* בונוסים מג'וקרים */}
                    {jokers.length > 0 && (
                      <div className="border-t border-gray-600 pt-2 mt-2">
                        <div className="text-yellow-400 text-xs font-bold mb-1">🃏 בונוסים מג'וקרים:</div>
                        {jokers.some(j => j.id === 'doubles') && selected.reduce((count, c) => {
                          const letterCount = selected.filter(card => card.letter === c.letter).length;
                          return Math.max(count, letterCount);
                        }, 0) >= 2 && (
                          <div className="text-yellow-300 text-xs">• כפילות: +20 צ'יפס</div>
                        )}
                        {jokers.some(j => j.id === 'five_stars') && selected.length === 5 && (
                          <div className="text-yellow-300 text-xs">• חמש כוכבים: ×5 מכפיל!</div>
                        )}
                        {jokers.some(j => j.id === 'rainbow') && (() => {
                          const colors = new Set(selected.map(c => c.color).filter(c => c !== 'rainbow'));
                          return colors.size === 4;
                        })() && (
                          <div className="text-yellow-300 text-xs">• צבעי הקשת: ×3 מכפיל!</div>
                        )}
                        {jokers.some(j => j.id === 'monochrome') && (() => {
                          const colors = new Set(selected.map(c => c.color).filter(c => c !== 'rainbow'));
                          return colors.size === 1 && selected.length >= 3;
                        })() && (
                          <div className="text-yellow-300 text-xs">• חד-גוני: ×5 מכפיל!</div>
                        )}
                        {jokers.some(j => j.id === 'big_head') && (
                          <div className="text-yellow-300 text-xs">• ראש גדול: אות ראשונה ×4</div>
                        )}
                        {jokers.some(j => j.id === 'happy_end') && (
                          <div className="text-yellow-300 text-xs">• סוף טוב: אות אחרונה ×4</div>
                        )}
                        {jokers.some(j => j.id === 'mega_combo') && (
                          <div className="text-orange-300 text-xs">• מגה קומבו: +{megaComboMult} למכפיל (מילה {megaComboMult})</div>
                        )}
                        {jokers.some(j => j.id === 'double_mult') && (
                          <div className="text-yellow-300 text-xs">• מכפיל כפול: ×2 מכפיל</div>
                        )}
                        {jokers.some(j => j.id === 'lucky_alef') && selected.some(c => c.letter === 'א') && (
                          <div className="text-yellow-300 text-xs">• אלף מזל: +30 נקודות</div>
                        )}
                        {jokers.some(j => j.id === 'final_power') && selected.length > 0 && ['ן','ם','ף','ך','ץ'].includes(selected[selected.length-1]?.letter) && (
                          <div className="text-yellow-300 text-xs">• כוח סופי: אות סופית ×5</div>
                        )}
                        {jokers.some(j => j.id === 'coin_flip') && (
                          <div className="text-yellow-300 text-xs">• הטלת מטבע: 50% ×3 (אקראי!)</div>
                        )}
                        {jokers.some(j => j.id === 'lazy_joker') && streakCount > 0 && (
                          <div className="text-yellow-300 text-xs">• ג׳וקר עצלן: +20 (לא זרקת!)</div>
                        )}
                      </div>
                    )}
                  </div>
                </div>
              )}
              {selected.length < 2 && (
                <div className="text-lg text-gray-400">
                  בחר לפחות 2 אותיות
                </div>
              )}
            </div>
          )}

          {/* אישור מילה - מצב ילדים */}
          {needsApproval && (
            <div className="bg-gradient-to-br from-yellow-500/30 to-orange-500/30 border-4 border-yellow-500 rounded-xl p-6 mb-6 shadow-2xl backdrop-blur-sm">
              <div className="text-center mb-4">
                <div className="text-3xl font-bold mb-3 text-yellow-300">
                  המילה: {selectedWord}
                </div>
                <div className="text-xl mb-2 text-white">מבוגר, האם המילה נכונה?</div>
                <div className="text-green-400 font-bold text-2xl">{selectedScore.toLocaleString()} נקודות</div>
              </div>
              <div className="flex gap-4 justify-center">
                <button
                  onClick={approveWord}
                  className="px-12 py-4 bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 rounded-xl font-bold text-xl transition-all transform hover:scale-110 shadow-xl"
                >
                  ✓ כן, נכונה
                </button>
                <button
                  onClick={rejectWord}
                  className="px-12 py-4 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 rounded-xl font-bold text-xl transition-all transform hover:scale-110 shadow-xl"
                >
                  ✗ לא נכונה
                </button>
              </div>
            </div>
          )}

          {/* כפתורי פעולה */}
          {!needsApproval && (
            <div className="flex justify-center gap-4">
              <button
                onClick={playHand}
                disabled={selected.length < 2}
                className={`
                  px-12 py-5 rounded-xl font-bold text-2xl transition-all transform shadow-2xl
                  ${selected.length >= 2
                    ? 'bg-gradient-to-r from-green-600 to-green-800 hover:from-green-700 hover:to-green-900 hover:scale-110 cursor-pointer'
                    : 'bg-gray-600 cursor-not-allowed opacity-50'
                  }
                `}
              >
                ✅ שחק מילה
              </button>
              
              <button
                onClick={discardCards}
                disabled={selected.length === 0 || discardsLeft <= 0}
                className={`
                  px-12 py-5 rounded-xl font-bold text-2xl transition-all transform shadow-2xl
                  ${selected.length > 0 && discardsLeft > 0
                    ? 'bg-gradient-to-r from-orange-600 to-orange-800 hover:from-orange-700 hover:to-orange-900 hover:scale-110 cursor-pointer'
                    : 'bg-gray-600 cursor-not-allowed opacity-50'
                  }
                `}
              >
                🔄 זרוק קלפים
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

        // Render the game
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>
</html>
